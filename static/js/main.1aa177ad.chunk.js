(this["webpackJsonppopulation-mesh"]=this["webpackJsonppopulation-mesh"]||[]).push([[0],{30:function(e,t,n){},31:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var c=n(0),o=n.n(c),a=n(11),r=n.n(a),l=(n(30),n(4)),i=n(2),s=(n(31),n(6));n(52);function u(e,t){var n=e.lat*Math.PI/180,c=t.lat*Math.PI/180,o=(t.lat-e.lat)*Math.PI/180,a=(t.lon-e.lon)*Math.PI/180,r=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(c)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function j(e){return'<?xml version="1.0" encoding="UTF-8"?>\n<kml xmlns="http://www.opengis.net/kml/2.2">\n    <Document>\n        <Style id="tier1_places">\n            <IconStyle>\n                <color>ffffff00</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier2_places">\n            <IconStyle>\n                <color>ffcf9a02</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier3_places">\n            <IconStyle>\n                <color>ffff7f00</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier4_places">\n            <IconStyle>\n                <color>ffcc0000</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier1_connectors">\n            <LineStyle>\n                <color>ffffff00</color>\n                <width>5</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier2_connectors">\n            <LineStyle>\n                <color>ffcf9a02</color>\n                <width>4</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier3_connectors">\n            <LineStyle>\n                <color>ffff7f00</color>\n                <width>3</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier4_connectors">\n            <LineStyle>\n                <color>ffcc0000</color>\n                <width>2</width>\n            </LineStyle>\n        </Style>\n        '.concat(e.map((function(e){return function(e){return"\n    <Folder>\n        <name>".concat(e.label,"</name>\n        ").concat(e.points&&e.points.map((function(t){return n=t,c=e.style,"\n        <Placemark>\n            <name>".concat(n.tags.name,"</name>\n            <description>Population: ").concat(n.tags.population,"</description>\n            <styleUrl>#").concat(c,"</styleUrl>\n            <Point>\n                <coordinates>").concat(n.lon,",").concat(n.lat,",0</coordinates>\n            </Point>\n        </Placemark>");var n,c})).join(""),"\n        ").concat(e.lines&&e.lines.map((function(t){return function(e,t){var n=Object(i.a)(e,2),c=n[0],o=n[1];return"\n        <Placemark>\n            <name>From ".concat(c.tags.name," to ").concat(o.tags.name,"</name>\n            <description>Distance: ").concat(u(c,o).toFixed(0),"m</description>\n            <styleUrl>#").concat(t,"</styleUrl>\n            <Point>\n                <coordinates>\n                    ").concat(c.lon,",").concat(c.lat,",0\n                    ").concat(o.lon,",").concat(o.lat,",0\n                </coordinates>\n            </Point>\n        </Placemark>")}(t,e.style)})).join(""),"\n    </Folder>")}(e)})).join(""),"\n    </Document>\n</kml>")}var b=n(5),h=["#00FFFF","#029ACF","#007FFF","#0000CC"];function d(e){return{"circle-radius":{base:5/e,stops:[[12,10/e],[22,180/e]]},"circle-color":h[e-1]}}function f(e){return{"line-width":{base:3/e,stops:[[12,5/e],[22,90/e]]},"line-color":h[e-1]}}function O(e,t){return{type:"FeatureCollection",features:[].concat(Object(l.a)(e.map((function(e){return{geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{name:e.tags.name}}}))),Object(l.a)(t.map((function(e){var t=Object(i.a)(e,2),n=t[0],c=t[1];return{geometry:{type:"LineString",coordinates:[[n.lon,n.lat],[c.lon,c.lat]]},properties:{name:"From ".concat(n.tags.name," to ").concat(c.tags.name)}}}))))}}function p(e,t){var n,c=[],o=Object(b.a)(e);try{for(o.s();!(n=o.n()).done;){var a,r=n.value,l=Object(b.a)(e);try{for(l.s();!(a=l.n()).done;){var i=a.value;if(r.id<i.id)u(r,i)<t&&c.push([r,i])}}catch(s){l.e(s)}finally{l.f()}}}catch(s){o.e(s)}finally{o.f()}return c}var y=n(1),k=Object(s.d)({accessToken:"pk.eyJ1IjoiaWptYWNkIiwiYSI6ImNqZ2J6dnNvYjM5Y3QzMnFkYWNybzM2bnkifQ.OE6IZdjeV6XK-NGACNu60g"});var m=function(){var e=Object(c.useState)([]),t=Object(i.a)(e,2),n=t[0],o=t[1],a=Object(c.useRef)(null),r=Object(c.useRef)([-3.667,56.66]),u=Object(c.useRef)([7]),b=Object(c.useState)(!1),h=Object(i.a)(b,2),m=h[0],v=h[1],P=Object(c.useState)(!1),C=Object(i.a)(P,2),w=C[0],M=C[1],F=Object(c.useState)(null),I=Object(i.a)(F,2),L=I[0],_=I[1],N=Object(c.useState)(!1),U=Object(i.a)(N,2),R=U[0],T=U[1],A=Object(c.useState)(105e3),D=Object(i.a)(A,2),E=D[0],Y=D[1],q=Object(c.useState)(!0),z=Object(i.a)(q,2),J=z[0],B=z[1],W=Object(c.useState)(!1),Q=Object(i.a)(W,2),Z=Q[0],G=Q[1],K=Object(c.useState)(!0),V=Object(i.a)(K,2),X=V[0],H=V[1],$=Object(c.useState)(!1),ee=Object(i.a)($,2),te=ee[0],ne=ee[1],ce=Object(c.useState)(!0),oe=Object(i.a)(ce,2),ae=oe[0],re=oe[1],le=Object(c.useState)(!1),ie=Object(i.a)(le,2),se=ie[0],ue=ie[1],je=Object(c.useState)(!0),be=Object(i.a)(je,2),he=be[0],de=be[1],fe=Object(c.useState)(!1),Oe=Object(i.a)(fe,2),pe=Oe[0],ye=Oe[1],ke=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=Object(c.useRef)(!0);return Object(c.useCallback)((function(){n.current&&(e.apply(void 0,arguments),n.current=!1,setTimeout((function(){return n.current=!0}),t))}),[e,t])}(me,5e3);function me(){a.current&&(function(e){var t=e.map((function(e){return e.toFixed(3)})).join(",");return function(e){var t=S.find((function(t){return t.url===e}));t||(t={url:e,result:fetch(e).then((function(e){return e.ok?e.json():429===e.status?Promise.reject("Too many requests. Please wait a minute."):Promise.reject("Error fetching data")}))},S.unshift(t),S.length=Math.min(10,S.length));return t.result}("https://overpass-api.de/api/interpreter?data=[out:json][bbox];(node[population];);out;&bbox=".concat(t))}(a.current.getBounds().toArray().flat()).then((function(e){o(e.elements),_(null)}),_).then((function(){return M(!1)})),M(!0))}var xe=n.length>0;Object(c.useEffect)((function(){function e(){!m&&xe||ke()}if(a.current)return a.current.on("moveend",e),function(){a.current.off("moveend",e)}}),[ke,m,xe,R]);var ge=J?g(n,1e5):[],Se=Z?p(ge,E):[],ve=O(ge,Se),Pe=d(1),Ce=f(1),we=X?g(n,5e4,1e5):[],Me=te?p([].concat(Object(l.a)(ge),Object(l.a)(we)),E):[],Fe=O(we,Me),Ie=d(2),Le=f(2),_e=ae?g(n,1e4,5e4):[],Ne=se?p([].concat(Object(l.a)(ge),Object(l.a)(we),Object(l.a)(_e)),E):[],Ue=O(_e,Ne),Re=d(3),Te=f(3),Ae=he?g(n,5e3,1e4):[],De=pe?p([].concat(Object(l.a)(ge),Object(l.a)(we),Object(l.a)(_e),Object(l.a)(Ae)),E):[],Ee=O(Ae,De),Ye=d(4),qe=f(4);return Object(y.jsxs)("div",{className:"App",children:[Object(y.jsxs)("div",{className:"Panel",children:[L?Object(y.jsx)("p",{style:{color:"red"},children:L.toString()}):Object(y.jsx)("p",{children:w?"Loading\u2026":Object(y.jsx)(x,{n:n.length,singular:"Total Place"})}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:m,onChange:function(e){return v(e.target.checked)}}),"Load on pan/zoom"]}),Object(y.jsx)("button",{onClick:me,children:"Load now"}),Object(y.jsx)("h2",{children:"100k+"}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:J,onChange:function(e){return B(e.target.checked)}}),Object(y.jsx)(x,{n:ge.length,singular:"Place"})]}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:Z,onChange:function(e){return G(e.target.checked)}}),Object(y.jsx)(x,{n:Se.length,singular:"Connection"})]}),Object(y.jsx)("h2",{children:"50k - 100k"}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:X,onChange:function(e){return H(e.target.checked)}}),Object(y.jsx)(x,{n:we.length,singular:"Place"})]}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:te,onChange:function(e){return ne(e.target.checked)}}),Object(y.jsx)(x,{n:Me.length,singular:"Connection"})]}),Object(y.jsx)("h2",{children:"10k - 50k"}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:ae,onChange:function(e){return re(e.target.checked)}}),Object(y.jsx)(x,{n:_e.length,singular:"Place"})]}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:se,onChange:function(e){return ue(e.target.checked)}}),Object(y.jsx)(x,{n:Ne.length,singular:"Connection"})]}),Object(y.jsx)("h2",{children:"5k - 10k"}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:he,onChange:function(e){return de(e.target.checked)}}),Object(y.jsx)(x,{n:Ae.length,singular:"Place"})]}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:pe,onChange:function(e){return ye(e.target.checked)}}),Object(y.jsx)(x,{n:De.length,singular:"Connection"})]}),Object(y.jsx)("h2",{children:"Options"}),Object(y.jsxs)("label",{children:["Max Connector Length (km)",Object(y.jsx)("input",{type:"number",min:0,value:E/1e3,onChange:function(e){return Y(1e3*e.target.valueAsNumber)}})]}),Object(y.jsx)("h2",{children:"Download"}),Object(y.jsx)("button",{onClick:function(){var e=[];J&&e.push({label:"100k+",points:ge,style:"tier1_places"}),X&&e.push({label:"50k - 100k",points:we,style:"tier2_places"}),ae&&e.push({label:"10k - 50k",points:_e,style:"tier3_places"}),he&&e.push({label:"5k - 10k",points:Ae,style:"tier4_places"}),Z&&e.push({label:"Connections 100k+",lines:Se,style:"tier1_connectors"}),te&&e.push({label:"Connections 50k - 100k",lines:Me,style:"tier2_connectors"}),se&&e.push({label:"Connections 10k - 50k",lines:Ne,style:"tier3_connectors"}),pe&&e.push({label:"Connections 5k - 10k",lines:De,style:"tier4_connectors"}),function(e,t){var n=new Blob([t]),c=window.URL.createObjectURL(n),o=document.createElement("a");o.href=c,o.download=e,document.body.append(o),o.click(),setTimeout((function(){document.body.removeChild(o),window.URL.revokeObjectURL(c)}))}("places.kml",j(e))},children:"kml"})]}),Object(y.jsxs)(k,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"100vh",width:"100vw"},onSourceData:function(e){a.current||T(!0),a.current=e},center:r.current,zoom:u.current,children:[Object(y.jsx)(s.a,{data:ve,circlePaint:Pe,linePaint:Ce}),Object(y.jsx)(s.a,{data:Fe,circlePaint:Ie,linePaint:Le}),Object(y.jsx)(s.a,{data:Ue,circlePaint:Re,linePaint:Te}),Object(y.jsx)(s.a,{data:Ee,circlePaint:Ye,linePaint:qe}),Object(y.jsx)(s.c,{}),Object(y.jsx)(s.b,{})]})]})};function x(e){var t=e.n,n=e.singular,c=e.plural,o=void 0===c?null:c;return Object(y.jsx)(y.Fragment,{children:"".concat(t," ").concat(1===t?n:o||n+"s")})}function g(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return e.filter((function(e){return t<=+e.tags.population&&+e.tags.population<n}))}var S=[];r.a.render(Object(y.jsx)(o.a.StrictMode,{children:Object(y.jsx)(m,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.1aa177ad.chunk.js.map