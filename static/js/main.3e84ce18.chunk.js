(this["webpackJsonppopulation-mesh"]=this["webpackJsonppopulation-mesh"]||[]).push([[0],{30:function(e,t,n){},31:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var c=n(0),o=n.n(c),a=n(11),r=n.n(a),i=(n(30),n(3)),l=n(2),s=(n(31),n(6)),u=(n(52),n(5));function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return e.filter((function(e){return t<=+e.tags.population&&+e.tags.population<n}))}function f(e,t,n){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=j(e,t);return n>0&&(o=p(o,n)),c.length>0&&(o=y(o,c)),o}function j(e,t){var n,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=[],a=Object(u.a)(e);try{for(a.s();!(n=a.n()).done;){var r,i=n.value,l=Object(u.a)(e);try{for(l.s();!(r=l.n()).done;){var s=r.value;if(i.id<s.id){var h=O(i,s);h<t&&!b(i,s,c)&&o.push([i,s])}}}catch(f){l.e(f)}finally{l.f()}}}catch(f){a.e(f)}finally{a.f()}return o}function b(e,t,n){var c,o=e.id<t.id?e:t,a=e.id<t.id?t:e,r=Object(u.a)(n);try{for(r.s();!(c=r.n()).done;){var i=Object(l.a)(c.value,2),s=i[0],h=i[1];if(o===s&&a===h)return!0}}catch(f){r.e(f)}finally{r.f()}return!1}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t<=0)return e;e.sort(d);var n,c=[],o=Object(u.a)(e);try{for(o.s();!(n=o.n()).done;){var a,r=n.value,i=!0,l=Object(u.a)(c);try{for(l.s();!(a=l.n()).done;){var s=a.value,h=x(r,s);if(h){var f=g([h[1],h[0]],[h[1],h[2]]);if(f<t){i=!1;break}}}}catch(j){l.e(j)}finally{l.f()}i&&c.push(r)}}catch(j){o.e(j)}finally{o.f()}return c}function d(e,t){return O(e[0],e[1])-O(t[0],t[1])}function O(e,t){var n=e.lat*Math.PI/180,c=t.lat*Math.PI/180,o=(t.lat-e.lat)*Math.PI/180,a=(t.lon-e.lon)*Math.PI/180,r=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(c)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function g(e,t){var n=m(e[0],e[1]),c=m(t[0],t[1]),o=Math.abs(c-n);return o>180?180-(o-180):o}function m(e,t){var n=e.lat*Math.PI/180,c=t.lat*Math.PI/180,o=(t.lon-e.lon)*Math.PI/180,a=Math.cos(c)*Math.sin(o),r=Math.cos(n)*Math.sin(c)-Math.sin(n)*Math.cos(c)*Math.cos(o);return 180*Math.atan2(r,a)/Math.PI}function y(e,t){return e.filter((function(e){return"undefined"===typeof t.find((function(t){return e[0]===t[0]&&e[1]===t[1]}))}))}function x(e,t){return e[0]===t[0]?[e[1],e[0],t[1]]:e[0]===t[1]?[e[1],e[0],t[0]]:e[1]===t[0]?[e[0],e[1],t[1]]:e[1]===t[1]?[e[0],e[1],t[0]]:void 0}function S(e,t){return+t.tags.population-+e.tags.population}function v(e,t){var n=function(e,t){var n=+e.tags.population>+t.tags.population?"".concat(e.tags.name," and ").concat(t.tags.name):"".concat(t.tags.name," and ").concat(e.tags.name);return/ and .+ and /.test(n)?n.replace(/ and /,", "):n}(e,t),c=+e.tags.population,o=+t.tags.population,a=c+o,r=a.toString(),i=o/a;return{id:Math.min(e.id,t.id),lat:k(e.lat,t.lat,i),lon:k(e.lon,t.lon,i),type:"node",tags:{name:n,population:r}}}function k(e,t,n){return e+n*(t-e)}function P(e){return'<?xml version="1.0" encoding="UTF-8"?>\n<kml xmlns="http://www.opengis.net/kml/2.2">\n    <Document>\n        <Style id="tier1_places">\n            <IconStyle>\n                <color>ffffff00</color>\n                <scale>2</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier2_places">\n            <IconStyle>\n                <color>ffcf9a02</color>\n                <scale>1.6666</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier3_places">\n            <IconStyle>\n                <color>ffff7f00</color>\n                <scale>1.25</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier4_places">\n            <IconStyle>\n                <color>ffcc0000</color>\n                <scale>1</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier1_connectors">\n            <LineStyle>\n                <color>ffffff00</color>\n                <width>5</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier2_connectors">\n            <LineStyle>\n                <color>ffcf9a02</color>\n                <width>4</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier3_connectors">\n            <LineStyle>\n                <color>ffff7f00</color>\n                <width>3</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier4_connectors">\n            <LineStyle>\n                <color>ffcc0000</color>\n                <width>2</width>\n            </LineStyle>\n        </Style>\n        '.concat(e.map((function(e){return function(e){return"\n    <Folder>\n        <name>".concat(e.label,"</name>\n        ").concat(e.points?e.points.map((function(t){return n=t,c=e.style,"\n        <Placemark>\n            <name>".concat(n.tags.name,"</name>\n            <description>Population: ").concat(n.tags.population,"</description>\n            <styleUrl>#").concat(c,"</styleUrl>\n            <Point>\n                <coordinates>").concat(n.lon,",").concat(n.lat,",0</coordinates>\n            </Point>\n        </Placemark>");var n,c})).join(""):"","\n        ").concat(e.lines?e.lines.map((function(t){return function(e,t){var n=Object(l.a)(e,2),c=n[0],o=n[1];return"\n        <Placemark>\n            <name>".concat(c.tags.name," to ").concat(o.tags.name,"</name>\n            <description>Distance: ").concat(O(c,o).toFixed(0),"m</description>\n            <styleUrl>#").concat(t,"</styleUrl>\n            <LineString>\n                <coordinates>\n                    ").concat(c.lon,",").concat(c.lat,",0\n                    ").concat(o.lon,",").concat(o.lat,",0\n                </coordinates>\n            </LineString>\n        </Placemark>")}(t,e.style)})).join(""):"","\n    </Folder>")}(e)})).join(""),"\n    </Document>\n</kml>")}function M(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=Object(c.useState)((function(){var n=localStorage.getItem(e);if(n)try{return JSON.parse(n)}catch(c){}return t instanceof Function?t():t})),a=Object(l.a)(o,2),r=a[0],i=a[1];Object(c.useEffect)((function(){if(n){var t=function(t){if(t.key===e)try{i(JSON.parse(t.newValue))}catch(t){}};return window.addEventListener("storage",t),function(){return window.removeEventListener("storage",t)}}}),[e,n]);var s=Object(c.useCallback)((function(t){i(t),localStorage.setItem(e,JSON.stringify(t))}),[i,e]);return[r,s]}var w=["#00FFFF","#029ACF","#007FFF","#0000CC"];function E(e,t){return{type:"FeatureCollection",features:[].concat(Object(i.a)(e.map((function(e){return{geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{name:e.tags.name}}}))),Object(i.a)(t.map((function(e){var t=Object(l.a)(e,2),n=t[0],c=t[1];return{geometry:{type:"LineString",coordinates:[[n.lon,n.lat],[c.lon,c.lat]]},properties:{name:"From ".concat(n.tags.name," to ").concat(c.tags.name)}}}))))}}var _=n(1);function L(e){var t=e.places,n=void 0===t?[]:t,c=e.connectors,o=void 0===c?[]:c,a=e.tier,r=E(n,[]),i=E([],o),l=function(e){return{"circle-radius":{base:5/e,stops:[[12,10/e],[22,180/e]]},"circle-color":w[e-1]}}(a),u=function(e){return{"line-width":{base:3/e,stops:[[12,5/e],[22,90/e]]},"line-color":w[e-1]}}(a);return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(s.a,{data:r,circlePaint:l}),Object(_.jsx)(s.a,{data:i,linePaint:u})]})}function N(e){var t=e.n,n=e.singular,c=e.plural,o=void 0===c?null:c;return Object(_.jsx)(_.Fragment,{children:"".concat(t," ").concat(1===t?n:o||n+"s")})}function I(e){var t=e.label,n=e.places,c=e.connectors,o=e.showNodes,a=e.setShowNodes,r=e.showVertices,i=e.setShowVertices,l=e.maxVertexLength,s=e.setMaxVertexLength;return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("h2",{children:t}),Object(_.jsxs)("label",{children:[Object(_.jsx)("input",{type:"checkbox",checked:o,onChange:function(e){return a(e.target.checked)}}),Object(_.jsx)(N,{n:n.length,singular:"Place"})]}),Object(_.jsxs)("label",{children:[Object(_.jsx)("input",{type:"checkbox",checked:r,onChange:function(e){return i(e.target.checked)}}),Object(_.jsx)(N,{n:c.length,singular:"Connection"})]}),Object(_.jsxs)("label",{children:["Max Connection Length (km)",Object(_.jsx)("input",{type:"number",min:0,value:l/1e3,onChange:function(e){return s(1e3*e.target.valueAsNumber)}})]})]})}var C=Object(s.d)({accessToken:"pk.eyJ1IjoiaWptYWNkIiwiYSI6ImNqZ2J6dnNvYjM5Y3QzMnFkYWNybzM2bnkifQ.OE6IZdjeV6XK-NGACNu60g"}),T=function(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(n){}return}("POPMESH_CENTRE_ZOOM"),V=T?T.slice(0,2):[-3.667,56.66],F=T?T.slice(2):[7];var H=function(){var e=Object(c.useState)([]),t=Object(l.a)(e,2),n=t[0],o=t[1],a=Object(c.useRef)(null),r=M("POPMESH_LOAD_ON_SCROLL",!1),j=Object(l.a)(r,2),b=j[0],p=j[1],d=Object(c.useState)(!1),g=Object(l.a)(d,2),m=g[0],y=g[1],x=Object(c.useState)(null),k=Object(l.a)(x,2),w=k[0],E=k[1],T=Object(c.useState)(!1),H=Object(l.a)(T,2),A=H[0],D=H[1],U=M("POPMESH_NODES_T1",!0,!1),J=Object(l.a)(U,2),G=J[0],X=J[1],Y=M("POPMESH_VERTICES_T1",!0,!1),Z=Object(l.a)(Y,2),q=Z[0],z=Z[1],B=M("POPMESH_VERTEX_LENGTH_T1",105e3,!1),W=Object(l.a)(B,2),Q=W[0],K=W[1],$=M("POPMESH_NODES_T2",!0,!1),ee=Object(l.a)($,2),te=ee[0],ne=ee[1],ce=M("POPMESH_VERTICES_T2",!0,!1),oe=Object(l.a)(ce,2),ae=oe[0],re=oe[1],ie=M("POPMESH_VERTEX_LENGTH_T2",1e5,!1),le=Object(l.a)(ie,2),se=le[0],ue=le[1],he=M("POPMESH_NODES_T3",!0,!1),fe=Object(l.a)(he,2),je=fe[0],be=fe[1],pe=M("POPMESH_VERTICES_T3",!0,!1),de=Object(l.a)(pe,2),Oe=de[0],ge=de[1],me=M("POPMESH_VERTEX_LENGTH_T3",95e3,!1),ye=Object(l.a)(me,2),xe=ye[0],Se=ye[1],ve=M("POPMESH_NODES_T4",!0,!1),ke=Object(l.a)(ve,2),Pe=ke[0],Me=ke[1],we=M("POPMESH_VERTICES_T4",!1,!1),Ee=Object(l.a)(we,2),_e=Ee[0],Le=Ee[1],Ne=M("POPMESH_VERTEX_LENGTH_T4",9e4,!1),Ie=Object(l.a)(Ne,2),Ce=Ie[0],Te=Ie[1],Ve=M("POPMESH_NARROW_ANGLE",20,!1),Fe=Object(l.a)(Ve,2),He=Fe[0],Re=Fe[1],Ae=M("POPMESH_CONURBATION_COLLAPSE",!1,!1),De=Object(l.a)(Ae,2),Ue=De[0],Je=De[1],Ge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=Object(c.useRef)(!0);return Object(c.useCallback)((function(){n.current&&(e.apply(void 0,arguments),n.current=!1,setTimeout((function(){return n.current=!0}),t))}),[e,t])}(Xe,5e3);function Xe(){a.current&&(function(e){var t=e.map((function(e){return e.toFixed(3)})).join(",");return function(e){var t=R.find((function(t){return t.url===e}));t||(t={url:e,result:fetch(e).then((function(e){return e.ok?e.json():429===e.status?Promise.reject("Too many requests. Please wait a minute."):Promise.reject("Error fetching data")}))},R.unshift(t),R.length=Math.min(10,R.length));return t.result}('https://overpass-api.de/api/interpreter?data=[out:json][bbox];node[population][place~"^city|town|village$"];out;&bbox='.concat(t))}(a.current.getBounds().toArray().flat()).then((function(e){o(e.elements),E(null)}),E).then((function(){return y(!1)})),y(!0))}var Ye=n.length>0,Ze=Object(c.useMemo)((function(){return Ue?function(e,t){e.sort(S);var n,c=[],o=Object(u.a)(e);try{e:for(o.s();!(n=o.n()).done;){for(var a=n.value,r=0;r<c.length;r++){var i=c[r];if(O(a,i)<t){c[r]=v(a,i);continue e}}c.push(a)}}catch(l){o.e(l)}finally{o.f()}return c}(n,3500):n}),[Ue,n]);Object(c.useEffect)((function(){function e(){!b&&Ye||Ge();var e=a.current.getCenter().toArray(),t=a.current.getZoom();localStorage.setItem("POPMESH_CENTRE_ZOOM",JSON.stringify([].concat(Object(i.a)(e),[t])))}if(a.current)return a.current.on("sourcedata",e),function(){a.current.off("sourcedata",e)}}),[Ge,b,Ye,A]);var qe=h(Ze,1e5),ze=q?f(qe,Q,He):[],Be=h(Ze,5e4,1e5),We=[].concat(Object(i.a)(qe),Object(i.a)(Be)),Qe=ae?f(We,se,He,ze):[],Ke=h(Ze,1e4,5e4),$e=[].concat(Object(i.a)(qe),Object(i.a)(Be),Object(i.a)(Ke)),et=[].concat(Object(i.a)(ze),Object(i.a)(Qe)),tt=Oe?f($e,xe,He,et):[],nt=h(Ze,5e3,1e4),ct=[].concat(Object(i.a)(qe),Object(i.a)(Be),Object(i.a)(Ke),Object(i.a)(nt)),ot=[].concat(Object(i.a)(ze),Object(i.a)(Qe),Object(i.a)(tt)),at=_e?f(ct,Ce,He,ot):[];return Object(_.jsxs)("div",{className:"App",children:[Object(_.jsxs)("div",{className:"Panel",children:[w?Object(_.jsx)("p",{style:{color:"red"},children:w.toString()}):m?Object(_.jsx)("p",{children:"Loading\u2026"}):Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("p",{children:Object(_.jsx)(N,{n:n.length,singular:"Total Place"})}),n.length!==Ze.length&&Object(_.jsx)("p",{children:Object(_.jsx)(N,{n:Ze.length,singular:"Conurbation"})})]}),Object(_.jsxs)("label",{children:[Object(_.jsx)("input",{type:"checkbox",checked:b,onChange:function(e){return p(e.target.checked)}}),"Load on pan/zoom"]}),Object(_.jsx)("button",{onClick:Xe,children:"Load now"}),Object(_.jsx)(I,{label:"100k+",places:qe,connectors:ze,showNodes:G,setShowNodes:X,showVertices:q,setShowVertices:z,maxVertexLength:Q,setMaxVertexLength:K}),Object(_.jsx)(I,{label:"50k - 100k",places:Be,connectors:Qe,showNodes:te,setShowNodes:ne,showVertices:ae,setShowVertices:re,maxVertexLength:se,setMaxVertexLength:ue}),Object(_.jsx)(I,{label:"10k - 50k",places:Ke,connectors:tt,showNodes:je,setShowNodes:be,showVertices:Oe,setShowVertices:ge,maxVertexLength:xe,setMaxVertexLength:Se}),Object(_.jsx)(I,{label:"5k - 10k",places:nt,connectors:at,showNodes:Pe,setShowNodes:Me,showVertices:_e,setShowVertices:Le,maxVertexLength:Ce,setMaxVertexLength:Te}),Object(_.jsx)("h2",{children:"Options"}),Object(_.jsxs)("label",{children:["Narrow Angle Limit "," ",Object(_.jsx)("input",{type:"number",min:0,max:180,value:He,onChange:function(e){return Re(e.target.valueAsNumber)}})," ","(degrees)"]}),Object(_.jsxs)("label",{children:["Collapse Conurbations"," ",Object(_.jsx)("input",{type:"checkbox",checked:Ue,onChange:function(e){return Je(e.target.checked)}})]}),Object(_.jsx)("h2",{children:"Download"}),Object(_.jsx)("button",{onClick:function(){var e=[];G&&e.push({label:"100k+",points:qe,style:"tier1_places"}),te&&e.push({label:"50k - 100k",points:Be,style:"tier2_places"}),je&&e.push({label:"10k - 50k",points:Ke,style:"tier3_places"}),Pe&&e.push({label:"5k - 10k",points:nt,style:"tier4_places"}),q&&e.push({label:"Connections 100k+",lines:ze,style:"tier1_connectors"}),ae&&e.push({label:"Connections 50k - 100k",lines:Qe,style:"tier2_connectors"}),Oe&&e.push({label:"Connections 10k - 50k",lines:tt,style:"tier3_connectors"}),_e&&e.push({label:"Connections 5k - 10k",lines:at,style:"tier4_connectors"}),function(e,t){var n=new Blob([t]),c=window.URL.createObjectURL(n),o=document.createElement("a");o.href=c,o.download=e,document.body.append(o),o.click(),setTimeout((function(){document.body.removeChild(o),window.URL.revokeObjectURL(c)}))}("places.kml",P(e))},children:"kml"})]}),Object(_.jsxs)(C,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"100vh",width:"100vw"},onSourceData:function(e){a.current||D(!0),a.current=e},center:V,zoom:F,children:[Object(_.jsx)(L,{places:Pe?nt:[],connectors:at,tier:4}),Object(_.jsx)(L,{places:je?Ke:[],connectors:tt,tier:3}),Object(_.jsx)(L,{places:te?Be:[],connectors:Qe,tier:2}),Object(_.jsx)(L,{places:G?qe:[],connectors:ze,tier:1}),Object(_.jsx)(s.c,{}),Object(_.jsx)(s.b,{})]})]})};var R=[];r.a.render(Object(_.jsx)(o.a.StrictMode,{children:Object(_.jsx)(H,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.3e84ce18.chunk.js.map