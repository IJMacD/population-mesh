(this["webpackJsonppopulation-mesh"]=this["webpackJsonppopulation-mesh"]||[]).push([[0],{30:function(e,t,n){},31:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),o=n(11),r=n.n(o),i=(n(30),n(4)),l=n(2),s=(n(31),n(6));n(52);function u(e,t){var n=e.lat*Math.PI/180,c=t.lat*Math.PI/180,a=(t.lat-e.lat)*Math.PI/180,o=(t.lon-e.lon)*Math.PI/180,r=Math.sin(a/2)*Math.sin(a/2)+Math.cos(n)*Math.cos(c)*Math.sin(o/2)*Math.sin(o/2);return 6371e3*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function j(e){return'<?xml version="1.0" encoding="UTF-8"?>\n<kml xmlns="http://www.opengis.net/kml/2.2">\n    <Document>\n        <Style id="tier1_places">\n            <IconStyle>\n                <color>ffffff00</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier2_places">\n            <IconStyle>\n                <color>ffcf9a02</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier3_places">\n            <IconStyle>\n                <color>ffff7f00</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier4_places">\n            <IconStyle>\n                <color>ffcc0000</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier1_connectors">\n            <LineStyle>\n                <color>ffffff00</color>\n                <width>5</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier2_connectors">\n            <LineStyle>\n                <color>ffcf9a02</color>\n                <width>4</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier3_connectors">\n            <LineStyle>\n                <color>ffff7f00</color>\n                <width>3</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier4_connectors">\n            <LineStyle>\n                <color>ffcc0000</color>\n                <width>2</width>\n            </LineStyle>\n        </Style>\n        '.concat(e.map((function(e){return function(e){return"\n    <Folder>\n        <name>".concat(e.label,"</name>\n        ").concat(e.points&&e.points.map((function(t){return n=t,c=e.style,"\n        <Placemark>\n            <name>".concat(n.tags.name,"</name>\n            <description>Population: ").concat(n.tags.population,"</description>\n            <styleUrl>#").concat(c,"</styleUrl>\n            <Point>\n                <coordinates>").concat(n.lon,",").concat(n.lat,",0</coordinates>\n            </Point>\n        </Placemark>");var n,c})).join(""),"\n        ").concat(e.lines&&e.lines.map((function(t){return function(e,t){var n=Object(l.a)(e,2),c=n[0],a=n[1];return"\n        <Placemark>\n            <name>From ".concat(c.tags.name," to ").concat(a.tags.name,"</name>\n            <description>Distance: ").concat(u(c,a).toFixed(0),"m</description>\n            <styleUrl>#").concat(t,"</styleUrl>\n            <Point>\n                <coordinates>\n                    ").concat(c.lon,",").concat(c.lat,",0\n                    ").concat(a.lon,",").concat(a.lat,",0\n                </coordinates>\n            </Point>\n        </Placemark>")}(t,e.style)})).join(""),"\n    </Folder>")}(e)})).join(""),"\n    </Document>\n</kml>")}var b=n(5),h=["#00FFFF","#029ACF","#007FFF","#0000CC"];function O(e){return{"circle-radius":{base:5/e,stops:[[12,10/e],[22,180/e]]},"circle-color":h[e-1]}}function d(e){return{"line-width":{base:3/e,stops:[[12,5/e],[22,90/e]]},"line-color":h[e-1]}}function f(e,t){return{type:"FeatureCollection",features:[].concat(Object(i.a)(e.map((function(e){return{geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{name:e.tags.name}}}))),Object(i.a)(t.map((function(e){var t=Object(l.a)(e,2),n=t[0],c=t[1];return{geometry:{type:"LineString",coordinates:[[n.lon,n.lat],[c.lon,c.lat]]},properties:{name:"From ".concat(n.tags.name," to ").concat(c.tags.name)}}}))))}}function p(e,t){var n,c=[],a=Object(b.a)(e);try{for(a.s();!(n=a.n()).done;){var o,r=n.value,i=Object(b.a)(e);try{for(i.s();!(o=i.n()).done;){var l=o.value;if(r.id<l.id)u(r,l)<t&&c.push([r,l])}}catch(s){i.e(s)}finally{i.f()}}}catch(s){a.e(s)}finally{a.f()}return c}function g(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=Object(c.useState)((function(){var n=localStorage.getItem(e);if(n)try{return JSON.parse(n)}catch(c){}return t instanceof Function?t():t})),o=Object(l.a)(a,2),r=o[0],i=o[1];Object(c.useEffect)((function(){if(n){var t=function(t){if(t.key===e)try{i(JSON.parse(t.newValue))}catch(t){}};return window.addEventListener("storage",t),function(){return window.removeEventListener("storage",t)}}}),[e,n]);var s=Object(c.useCallback)((function(t){i(t),localStorage.setItem(e,JSON.stringify(t))}),[i,e]);return[r,s]}var y=n(1),m=Object(s.d)({accessToken:"pk.eyJ1IjoiaWptYWNkIiwiYSI6ImNqZ2J6dnNvYjM5Y3QzMnFkYWNybzM2bnkifQ.OE6IZdjeV6XK-NGACNu60g"}),x=function(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(n){}return}("POPMESH_CENTRE_ZOOM"),k=x?x.slice(0,2):[-3.667,56.66],S=x?x.slice(2):[7];var P=function(){var e=Object(c.useState)([]),t=Object(l.a)(e,2),n=t[0],a=t[1],o=Object(c.useRef)(null),r=g("POPMESH_LOAD_ON_SCROLL",!1),u=Object(l.a)(r,2),b=u[0],h=u[1],x=Object(c.useState)(!1),P=Object(l.a)(x,2),C=P[0],M=P[1],T=Object(c.useState)(null),w=Object(l.a)(T,2),L=w[0],N=w[1],I=Object(c.useState)(!1),F=Object(l.a)(I,2),H=F[0],R=F[1],A=g("POPMESH_NODES_T1",!0,!1),D=Object(l.a)(A,2),V=D[0],J=D[1],U=g("POPMESH_VERTICES_T1",!1,!1),G=Object(l.a)(U,2),X=G[0],Y=G[1],Z=g("POPMESH_VERTEX_LENGTH_T1",105e3,!1),q=Object(l.a)(Z,2),z=q[0],B=q[1],W=g("POPMESH_NODES_T2",!0,!1),Q=Object(l.a)(W,2),K=Q[0],$=Q[1],ee=g("POPMESH_VERTICES_T2",!1,!1),te=Object(l.a)(ee,2),ne=te[0],ce=te[1],ae=g("POPMESH_VERTEX_LENGTH_T2",8e4,!1),oe=Object(l.a)(ae,2),re=oe[0],ie=oe[1],le=g("POPMESH_NODES_T3",!0,!1),se=Object(l.a)(le,2),ue=se[0],je=se[1],be=g("POPMESH_VERTICES_T3",!1,!1),he=Object(l.a)(be,2),Oe=he[0],de=he[1],fe=g("POPMESH_VERTEX_LENGTH_T3",6e4,!1),pe=Object(l.a)(fe,2),ge=pe[0],ye=pe[1],me=g("POPMESH_NODES_T4",!0,!1),xe=Object(l.a)(me,2),ke=xe[0],Se=xe[1],Pe=g("POPMESH_VERTICES_T4",!1,!1),ve=Object(l.a)(Pe,2),Ee=ve[0],_e=ve[1],Ce=g("POPMESH_VERTEX_LENGTH_T4",5e4,!1),Me=Object(l.a)(Ce,2),Te=Me[0],we=Me[1],Le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=Object(c.useRef)(!0);return Object(c.useCallback)((function(){n.current&&(e.apply(void 0,arguments),n.current=!1,setTimeout((function(){return n.current=!0}),t))}),[e,t])}(Ne,5e3);function Ne(){o.current&&(function(e){var t=e.map((function(e){return e.toFixed(3)})).join(",");return function(e){var t=_.find((function(t){return t.url===e}));t||(t={url:e,result:fetch(e).then((function(e){return e.ok?e.json():429===e.status?Promise.reject("Too many requests. Please wait a minute."):Promise.reject("Error fetching data")}))},_.unshift(t),_.length=Math.min(10,_.length));return t.result}("https://overpass-api.de/api/interpreter?data=[out:json][bbox];(node[population];);out;&bbox=".concat(t))}(o.current.getBounds().toArray().flat()).then((function(e){a(e.elements),N(null)}),N).then((function(){return M(!1)})),M(!0))}var Ie=n.length>0;Object(c.useEffect)((function(){function e(){!b&&Ie||Le();var e=o.current.getCenter().toArray(),t=o.current.getZoom();localStorage.setItem("POPMESH_CENTRE_ZOOM",JSON.stringify([].concat(Object(i.a)(e),[t])))}if(o.current)return o.current.on("sourcedata",e),function(){o.current.off("sourcedata",e)}}),[Le,b,Ie,H]);var Fe=V?E(n,1e5):[],He=X?p(Fe,z):[],Re=f(Fe,He),Ae=O(1),De=d(1),Ve=K?E(n,5e4,1e5):[],Je=ne?p([].concat(Object(i.a)(Fe),Object(i.a)(Ve)),re):[],Ue=f(Ve,Je),Ge=O(2),Xe=d(2),Ye=ue?E(n,1e4,5e4):[],Ze=Oe?p([].concat(Object(i.a)(Fe),Object(i.a)(Ve),Object(i.a)(Ye)),ge):[],qe=f(Ye,Ze),ze=O(3),Be=d(3),We=ke?E(n,5e3,1e4):[],Qe=Ee?p([].concat(Object(i.a)(Fe),Object(i.a)(Ve),Object(i.a)(Ye),Object(i.a)(We)),Te):[],Ke=f(We,Qe),$e=O(4),et=d(4);return Object(y.jsxs)("div",{className:"App",children:[Object(y.jsxs)("div",{className:"Panel",children:[L?Object(y.jsx)("p",{style:{color:"red"},children:L.toString()}):Object(y.jsx)("p",{children:C?"Loading\u2026":Object(y.jsx)(v,{n:n.length,singular:"Total Place"})}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:b,onChange:function(e){return h(e.target.checked)}}),"Load on pan/zoom"]}),Object(y.jsx)("button",{onClick:Ne,children:"Load now"}),Object(y.jsx)("h2",{children:"100k+"}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:V,onChange:function(e){return J(e.target.checked)}}),Object(y.jsx)(v,{n:Fe.length,singular:"Place"})]}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:X,onChange:function(e){return Y(e.target.checked)}}),Object(y.jsx)(v,{n:He.length,singular:"Connection"})]}),Object(y.jsxs)("label",{children:["Max Connection Length (km)",Object(y.jsx)("input",{type:"number",min:0,value:z/1e3,onChange:function(e){return B(1e3*e.target.valueAsNumber)}})]}),Object(y.jsx)("h2",{children:"50k - 100k"}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:K,onChange:function(e){return $(e.target.checked)}}),Object(y.jsx)(v,{n:Ve.length,singular:"Place"})]}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:ne,onChange:function(e){return ce(e.target.checked)}}),Object(y.jsx)(v,{n:Je.length,singular:"Connection"})]}),Object(y.jsxs)("label",{children:["Max Connection Length (km)",Object(y.jsx)("input",{type:"number",min:0,value:re/1e3,onChange:function(e){return ie(1e3*e.target.valueAsNumber)}})]}),Object(y.jsx)("h2",{children:"10k - 50k"}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:ue,onChange:function(e){return je(e.target.checked)}}),Object(y.jsx)(v,{n:Ye.length,singular:"Place"})]}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:Oe,onChange:function(e){return de(e.target.checked)}}),Object(y.jsx)(v,{n:Ze.length,singular:"Connection"})]}),Object(y.jsxs)("label",{children:["Max Connection Length (km)",Object(y.jsx)("input",{type:"number",min:0,value:ge/1e3,onChange:function(e){return ye(1e3*e.target.valueAsNumber)}})]}),Object(y.jsx)("h2",{children:"5k - 10k"}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:ke,onChange:function(e){return Se(e.target.checked)}}),Object(y.jsx)(v,{n:We.length,singular:"Place"})]}),Object(y.jsxs)("label",{children:[Object(y.jsx)("input",{type:"checkbox",checked:Ee,onChange:function(e){return _e(e.target.checked)}}),Object(y.jsx)(v,{n:Qe.length,singular:"Connection"})]}),Object(y.jsxs)("label",{children:["Max Connection Length (km)",Object(y.jsx)("input",{type:"number",min:0,value:Te/1e3,onChange:function(e){return we(1e3*e.target.valueAsNumber)}})]}),Object(y.jsx)("h2",{children:"Download"}),Object(y.jsx)("button",{onClick:function(){var e=[];V&&e.push({label:"100k+",points:Fe,style:"tier1_places"}),K&&e.push({label:"50k - 100k",points:Ve,style:"tier2_places"}),ue&&e.push({label:"10k - 50k",points:Ye,style:"tier3_places"}),ke&&e.push({label:"5k - 10k",points:We,style:"tier4_places"}),X&&e.push({label:"Connections 100k+",lines:He,style:"tier1_connectors"}),ne&&e.push({label:"Connections 50k - 100k",lines:Je,style:"tier2_connectors"}),Oe&&e.push({label:"Connections 10k - 50k",lines:Ze,style:"tier3_connectors"}),Ee&&e.push({label:"Connections 5k - 10k",lines:Qe,style:"tier4_connectors"}),function(e,t){var n=new Blob([t]),c=window.URL.createObjectURL(n),a=document.createElement("a");a.href=c,a.download=e,document.body.append(a),a.click(),setTimeout((function(){document.body.removeChild(a),window.URL.revokeObjectURL(c)}))}("places.kml",j(e))},children:"kml"})]}),Object(y.jsxs)(m,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"100vh",width:"100vw"},onSourceData:function(e){o.current||R(!0),o.current=e},center:k,zoom:S,children:[Object(y.jsx)(s.a,{data:Re,circlePaint:Ae,linePaint:De}),Object(y.jsx)(s.a,{data:Ue,circlePaint:Ge,linePaint:Xe}),Object(y.jsx)(s.a,{data:qe,circlePaint:ze,linePaint:Be}),Object(y.jsx)(s.a,{data:Ke,circlePaint:$e,linePaint:et}),Object(y.jsx)(s.c,{}),Object(y.jsx)(s.b,{})]})]})};function v(e){var t=e.n,n=e.singular,c=e.plural,a=void 0===c?null:c;return Object(y.jsx)(y.Fragment,{children:"".concat(t," ").concat(1===t?n:a||n+"s")})}function E(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return e.filter((function(e){return t<=+e.tags.population&&+e.tags.population<n}))}var _=[];r.a.render(Object(y.jsx)(a.a.StrictMode,{children:Object(y.jsx)(P,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.4a06cff6.chunk.js.map