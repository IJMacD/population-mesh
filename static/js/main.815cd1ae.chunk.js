(this["webpackJsonppopulation-mesh"]=this["webpackJsonppopulation-mesh"]||[]).push([[0],{36:function(e,t,n){},37:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),a=n(15),o=n.n(a),i=(n(36),n(3)),s=n(2),l=(n(37),n(7)),u=(n(58),n(4));function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return e.filter((function(e){return t<=+e.tags.population&&+e.tags.population<n}))}function p(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],c=d(e,t);return n>0&&(c=f(c,n)),r.length>0&&(c=y(c,r)),c}function d(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],c=[],a=Object(u.a)(e);try{for(a.s();!(n=a.n()).done;){var o,i=n.value,s=Object(u.a)(e);try{for(s.s();!(o=s.n()).done;){var l=o.value;if(i.id<l.id){var h=O(i,l);h<t&&!j(i,l,r)&&c.push([i,l])}}}catch(p){s.e(p)}finally{s.f()}}}catch(p){a.e(p)}finally{a.f()}return c}function j(e,t,n){var r,c=e.id<t.id?e:t,a=e.id<t.id?t:e,o=Object(u.a)(n);try{for(o.s();!(r=o.n()).done;){var i=Object(s.a)(r.value,2),l=i[0],h=i[1];if(c===l&&a===h)return!0}}catch(p){o.e(p)}finally{o.f()}return!1}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t<=0)return e;e.sort(b);var n,r=[],c=Object(u.a)(e);try{for(c.s();!(n=c.n()).done;){var a,o=n.value,i=!0,s=Object(u.a)(r);try{for(s.s();!(a=s.n()).done;){var l=a.value,h=x(o,l);if(h){var p=g([h[1],h[0]],[h[1],h[2]]);if(p<t){i=!1;break}}}}catch(d){s.e(d)}finally{s.f()}i&&r.push(o)}}catch(d){c.e(d)}finally{c.f()}return r}function b(e,t){return O(e[0],e[1])-O(t[0],t[1])}function O(e,t){var n=e.lat*Math.PI/180,r=t.lat*Math.PI/180,c=(t.lat-e.lat)*Math.PI/180,a=(t.lon-e.lon)*Math.PI/180,o=Math.sin(c/2)*Math.sin(c/2)+Math.cos(n)*Math.cos(r)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}function g(e,t){var n=m(e[0],e[1]),r=m(t[0],t[1]),c=Math.abs(r-n);return c>180?180-(c-180):c}function m(e,t){var n=e.lat*Math.PI/180,r=t.lat*Math.PI/180,c=(t.lon-e.lon)*Math.PI/180,a=Math.cos(r)*Math.sin(c),o=Math.cos(n)*Math.sin(r)-Math.sin(n)*Math.cos(r)*Math.cos(c);return 180*Math.atan2(o,a)/Math.PI}function y(e,t){return e.filter((function(e){return"undefined"===typeof t.find((function(t){return e[0]===t[0]&&e[1]===t[1]}))}))}function x(e,t){return e[0]===t[0]?[e[1],e[0],t[1]]:e[0]===t[1]?[e[1],e[0],t[0]]:e[1]===t[0]?[e[0],e[1],t[1]]:e[1]===t[1]?[e[0],e[1],t[0]]:void 0}function v(e,t){return+t.tags.population-+e.tags.population}function S(e,t){var n=function(e,t){var n=+e.tags.population>+t.tags.population?"".concat(e.tags.name," and ").concat(t.tags.name):"".concat(t.tags.name," and ").concat(e.tags.name);return/ and .+ and /.test(n)?n.replace(/ and /,", "):n}(e,t),r=+e.tags.population,c=+t.tags.population,a=r+c,o=a.toString(),i=c/a;return{id:Math.min(e.id,t.id),lat:w(e.lat,t.lat,i),lon:w(e.lon,t.lon,i),type:"node",tags:{name:n,population:o}}}function w(e,t,n){return e+n*(t-e)}function k(e){return'<?xml version="1.0" encoding="UTF-8"?>\n<kml xmlns="http://www.opengis.net/kml/2.2">\n    <Document>\n        <Style id="tier1_places">\n            <IconStyle>\n                <color>ffffff00</color>\n                <scale>2</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier2_places">\n            <IconStyle>\n                <color>ffcf9a02</color>\n                <scale>1.6666</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier3_places">\n            <IconStyle>\n                <color>ffff7f00</color>\n                <scale>1.25</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier4_places">\n            <IconStyle>\n                <color>ffcc0000</color>\n                <scale>1</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier1_connectors">\n            <LineStyle>\n                <color>ffffff00</color>\n                <width>5</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier2_connectors">\n            <LineStyle>\n                <color>ffcf9a02</color>\n                <width>4</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier3_connectors">\n            <LineStyle>\n                <color>ffff7f00</color>\n                <width>3</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier4_connectors">\n            <LineStyle>\n                <color>ffcc0000</color>\n                <width>2</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier1_shapes">\n            <PolyStyle>\n                <color>ffffff00</color>\n                <outline>0</outline>\n            </PolyStyle>\n        </Style>\n        <Style id="tier2_shapes">\n            <PolyStyle>\n                <color>ffcf9a02</color>\n                <outline>0</outline>\n            </PolyStyle>\n        </Style>\n        <Style id="tier3_shapes">\n            <PolyStyle>\n                <color>ffff7f00</color>\n                <outline>0</outline>\n            </PolyStyle>\n        </Style>\n        <Style id="tier4_shapes">\n            <PolyStyle>\n                <color>ffcc0000</color>\n                <outline>0</outline>\n            </PolyStyle>\n        </Style>\n        '.concat(e.map((function(e){return function(e){return"\n    <Folder>\n        <name>".concat(e.label,"</name>\n        ").concat(e.points?e.points.map((function(t){return n=t,r=e.style,"\n        <Placemark>\n            <name>".concat(n.tags.name,"</name>\n            <description>Population: ").concat(n.tags.population,"</description>\n            <styleUrl>#").concat(r,"</styleUrl>\n            <Point>\n                <coordinates>").concat(n.lon,",").concat(n.lat,",0</coordinates>\n            </Point>\n        </Placemark>");var n,r})).join(""):"","\n        ").concat(e.lines?e.lines.map((function(t){return function(e,t){var n=Object(s.a)(e,2),r=n[0],c=n[1];return"\n        <Placemark>\n            <name>".concat(r.tags.name," to ").concat(c.tags.name,"</name>\n            <description>Distance: ").concat(O(r,c).toFixed(0),"m</description>\n            <styleUrl>#").concat(t,"</styleUrl>\n            <LineString>\n                <coordinates>\n                    ").concat(r.lon,",").concat(r.lat,",0\n                    ").concat(c.lon,",").concat(c.lat,",0\n                </coordinates>\n            </LineString>\n        </Placemark>")}(t,e.style)})).join(""):"","\n        ").concat(e.shapes?e.shapes.map((function(t){return function(e,t){var n="";if("Polygon"===e.geometry.type){var r=e.geometry.coordinates[0];n="<Polygon>\n                        <outerBoundaryIs>\n                            <LinearRing>\n                                <coordinates>\n                                    ".concat(r.map((function(e){return"".concat(e[0],",").concat(e[1],",0")})).join(" "),"\n                                </coordinates>\n                            </LinearRing>\n                        </outerBoundaryIs>\n                    </Polygon>")}else if("MultiPolygon"===e.geometry.type){var c=e.geometry.coordinates[0][0],a=e.geometry.coordinates[0].slice(1);n="<Polygon>\n            <outerBoundaryIs>\n                <LinearRing>\n                    <coordinates>\n                    ".concat(c.map((function(e){return"".concat(e[0],",").concat(e[1],",0")})).join(" "),"\n                    </coordinates>\n                </LinearRing>\n            </outerBoundaryIs>\n            ").concat(a.map((function(e){return"<innerBoundaryIs>\n                <LinearRing>\n                    <coordinates>\n                        ".concat(e.map((function(e){return"".concat(e[0],",").concat(e[1],",0")})).join(" "),"\n                    </coordinates>\n                </LinearRing>\n            </innerBoundaryIs>")})).join(""),"\n        </Polygon>")}return"\n        <Placemark>\n            <name>".concat(e.properties.name,"</name>\n            <styleUrl>#").concat(t,"</styleUrl>\n            ").concat(n,"\n        </Placemark>")}(t,e.style)})).join(""):"","\n    </Folder>")}(e)})).join(""),"\n    </Document>\n</kml>")}function P(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=Object(r.useState)((function(){var n=localStorage.getItem(e);if(n)try{return JSON.parse(n)}catch(r){}return t instanceof Function?t():t})),a=Object(s.a)(c,2),o=a[0],i=a[1];Object(r.useEffect)((function(){if(n){var t=function(t){if(t.key===e)try{i(JSON.parse(t.newValue))}catch(t){}};return window.addEventListener("storage",t),function(){return window.removeEventListener("storage",t)}}}),[e,n]);var l=Object(r.useCallback)((function(t){i(t),localStorage.setItem(e,JSON.stringify(t))}),[i,e]);return[o,l]}var _=["#00FFFF","#029ACF","#007FFF","#0000CC"];function E(e,t){return{type:"FeatureCollection",features:[].concat(Object(i.a)(e.map((function(e){return{geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{name:e.tags.name}}}))),Object(i.a)(t.map((function(e){var t=Object(s.a)(e,2),n=t[0],r=t[1];return{geometry:{type:"LineString",coordinates:[[n.lon,n.lat],[r.lon,r.lat]]},properties:{name:"From ".concat(n.tags.name," to ").concat(r.tags.name)}}}))))}}var M=n(0);function I(e){var t=e.places,n=void 0===t?[]:t,r=e.connectors,c=void 0===r?[]:r,a=e.shapes,o=void 0===a?[]:a,i=e.tier,s=E(n,[]),u=E([],c),h={type:"FeatureCollection",features:o},p=function(e){return{"circle-radius":{base:5/e,stops:[[12,10/e],[22,180/e]]},"circle-color":_[e-1]}}(i),d=function(e){return{"fill-color":_[e-1]}}(i),j=function(e){return{"line-width":{base:3/e,stops:[[12,5/e],[22,90/e]]},"line-color":_[e-1]}}(i);return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(l.a,{data:s,circlePaint:p}),Object(M.jsx)(l.a,{data:h,fillPaint:d}),Object(M.jsx)(l.a,{data:u,linePaint:j})]})}function L(e){var t=e.n,n=e.singular,r=e.plural,c=void 0===r?null:r;return Object(M.jsx)(M.Fragment,{children:"".concat(t," ").concat(1===t?n:c||n+"s")})}function C(e){var t=e.label,n=e.places,r=e.connectors,c=e.showNodes,a=e.setShowNodes,o=e.showVertices,i=e.setShowVertices,s=e.maxVertexLength,l=e.setMaxVertexLength,u=e.showShapes,h=e.setShowShapes;return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("h2",{children:t}),Object(M.jsxs)("label",{children:[Object(M.jsx)("input",{type:"checkbox",checked:c,onChange:function(e){return a(e.target.checked)}}),Object(M.jsx)(L,{n:n.length,singular:"Place"})]}),h&&Object(M.jsxs)("label",{children:[Object(M.jsx)("input",{type:"checkbox",checked:u,onChange:function(e){return h(e.target.checked)}}),"Show Built up Areas"]}),Object(M.jsxs)("label",{children:[Object(M.jsx)("input",{type:"checkbox",checked:o,onChange:function(e){return i(e.target.checked)}}),Object(M.jsx)(L,{n:r.length,singular:"Connection"})]}),Object(M.jsxs)("label",{children:["Max Connection Length (km)",Object(M.jsx)("input",{type:"number",min:0,value:s/1e3,onChange:function(e){return l(1e3*e.target.valueAsNumber)}})]})]})}var N=n(6),T=n.n(N),H=n(11);function R(e){return V.apply(this,arguments)}function V(){return(V=Object(H.a)(T.a.mark((function e(t){var r,c;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(3).then(n.t.bind(null,62,3));case 2:return r=e.sent.default,c=r.filter((function(e){return A(e,t)})),e.abrupt("return",c.map((function(e){return{id:e.id,type:"node",lat:e.lat,lon:e.lon,tags:{name:e.name,population:e.pop.toString(),place:"built_up_area"}}})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t){return e.lon>=t[0]&&e.lon<t[2]&&e.lat>=t[1]&&e.lat<t[3]}function F(e){var t=Object(r.useState)([]),n=Object(s.a)(t,2),c=n[0],a=n[1],o=function(){var e=Object(r.useRef)();e.current||(e.current=new Promise((function(e,t){var n=indexedDB.open("POPMESH_NOMIS");n.onupgradeneeded=function(e){e.target.result.createObjectStore("shapes",{keyPath:"id"})},n.onsuccess=function(t){return e(t.target.result)},n.onerror=function(e){return t(e.target.errorCode)}})));return e.current}(),i=function(e,t){var n=Object(r.useRef)(),c=Object(r.useRef)();n.current&&function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(n.current,t)||(n.current=t,c.current=e());return c.current}((function(){return e}),e);return Object(r.useEffect)((function(){o.then(function(){var e=Object(H.a)(T.a.mark((function e(t){var n,r,c;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(i.map((function(e){return W(t,e)})));case 2:n=e.sent,r=n.filter((function(e){return e})),c=i.filter((function(e,t){return!n[t]})),a(r),D(t,c,10,a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[i]),c}function D(e,t,n,r){return B.apply(this,arguments)}function B(){return(B=Object(H.a)(T.a.mark((function e(t,n,r,c){var a,o;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0,o=T.a.mark((function e(){var o,s,l,h,p,d,j,f;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a+r,s=n.slice(a,o),a=o,e.next=5,Promise.all(s.map(U));case 5:l=e.sent,h=t.transaction("shapes","readwrite"),p=h.objectStore("shapes"),d=Object(u.a)(l);try{for(d.s();!(j=d.n()).done;)f=j.value,p.add(f)}catch(b){d.e(b)}finally{d.f()}c((function(e){return[].concat(Object(i.a)(e),Object(i.a)(l))}));case 11:case"end":return e.stop()}}),e)}));case 2:if(!(a<n.length)){e.next=6;break}return e.delegateYield(o(),"t0",4);case 4:e.next=2;break;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return J.apply(this,arguments)}function J(){return(J=Object(H.a)(T.a.mark((function e(t){var n,r;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://www.nomisweb.co.uk/websvc/geojson.aspx?geogs=".concat(t));case 2:if((n=e.sent).ok){e.next=5;break}return e.abrupt("return",n.text().then((function(e){return Promise.reject(e)})));case 5:return e.next=7,n.json();case 7:return r=e.sent,e.abrupt("return",r.features[0]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t){return z.apply(this,arguments)}function z(){return(z=Object(H.a)(T.a.mark((function e(t,n){var r,c,a;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.transaction("shapes"),c=r.objectStore("shapes"),a=c.get(n.toString()),e.abrupt("return",new Promise((function(e,t){a.onerror=t,a.onsuccess=function(t){var n=t.target.result;e(n)}})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t){var n=e.map((function(e){return e.toFixed(3)})).join(","),r=Object.entries(t).map((function(e){var t=Object(s.a)(e,2),n=t[0],r=t[1];return!0===r?"[".concat(n,"]"):Array.isArray(r)?"[".concat(n,'~"^').concat(r.join("|"),'$"]'):"[".concat(n,'="').concat(r,'"]')})).join("");if(!r)throw new Error("Too many nodes");return function(e){var t=G.find((function(t){return t.url===e}));t||(t={url:e,result:fetch(e).then((function(e){return e.ok?e.json():429===e.status?Promise.reject("Too many requests. Please wait a minute."):Promise.reject("Error fetching data")}))},G.unshift(t),G.length=Math.min(10,G.length));return t.result}("https://overpass-api.de/api/interpreter?data=[out:json][bbox];node".concat(r,";out ").concat(1e4,";&bbox=").concat(n))}var G=[];function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=Object(r.useState)(null),c=Object(s.a)(n,2),a=c[0],o=c[1],i=Object(r.useState)(null),l=Object(s.a)(i,2),u=l[0],h=l[1],p=Object(r.useState)(!1),d=Object(s.a)(p,2),j=d[0],f=d[1];return Object(r.useEffect)((function(){fetch(e,t).then((function(e){return e.ok?e.headers.get("Content-Type").includes("application/json")?e.json():e.text():Promise.reject("Error fetching data")})).then((function(e){o(e),h(null)}),h).then((function(){return f(!1)})),f(!0)}),[e,t]),[a,u,j]}var X={place:["city","town","village"]};function Z(e){var t=e.bounds,n=e.sourceID;return"osm"===n?Object(M.jsx)(K,{bounds:t}):"nomis"===n?Object(M.jsx)(Q,{bounds:t}):null}function K(e){var t=function(e,t){var n=Object(r.useState)([]),c=Object(s.a)(n,2),a=c[0],o=c[1],i=Object(r.useState)(null),l=Object(s.a)(i,2),u=l[0],h=l[1],p=Object(r.useState)(!1),d=Object(s.a)(p,2),j=d[0],f=d[1];return Object(r.useEffect)((function(){q(e,t).then((function(e){o(e.elements),h(null)}),h).then((function(){return f(!1)})),f(!0)}),[e,t]),[a,u,j]}(e.bounds,X),n=Object(s.a)(t,3),c=n[0],a=n[1],o=n[2];return Object(M.jsx)($,{data:c,error:a,loading:o})}function Q(e){var t=e.bounds,n=Object(r.useState)([]),c=Object(s.a)(n,2),a=c[0],o=c[1],i=Object(r.useState)(null),l=Object(s.a)(i,2),u=l[0],h=l[1],p=Object(r.useState)(!1),d=Object(s.a)(p,2),j=d[0],f=d[1];return Object(r.useEffect)((function(){R(t).then(o,h).then((function(){return f(!1)})),f(!0)}),t),Object(M.jsx)($,{data:a,error:u,loading:j})}function $(e){var t=e.data,n=e.error,r=e.loading;t.sort(ee);return Object(M.jsxs)("section",{style:{backgroundColor:"white",width:"80%",position:"fixed",height:"90%",top:"5%",left:"10%",borderRadius:30,padding:20,boxSizing:"border-box",boxShadow:"-10px -10px 60px rgba(0,0,0,0.6), 15px 15px 20px rgba(0,0,0,0.6)",display:"flex",flexDirection:"column"},children:[Object(M.jsx)("h1",{children:"Population Inspector"}),r&&Object(M.jsx)("p",{children:"Loading\u2026"}),n&&Object(M.jsx)("p",{style:{color:"red"},children:n.toString()}),t.length>0&&Object(M.jsx)("div",{style:{flex:1,overflowY:"auto"},children:Object(M.jsxs)("table",{children:[Object(M.jsx)("thead",{children:Object(M.jsxs)("tr",{children:[Object(M.jsx)("th",{children:"Name"}),Object(M.jsx)("th",{children:"Type"}),Object(M.jsx)("th",{children:"Population"}),Object(M.jsx)("th",{children:"Links"}),Object(M.jsx)("th",{children:"Wikidata"}),Object(M.jsx)("th",{children:"Wikipedia"})]})}),Object(M.jsx)("tbody",{children:t.map((function(e){var t;return Object(M.jsxs)("tr",{children:[Object(M.jsx)("td",{children:e.tags.name}),Object(M.jsx)("td",{children:e.tags.place}),Object(M.jsxs)("td",{children:[Object(M.jsx)(te,{population:+e.tags.population||0}),e.tags.population||""]}),Object(M.jsxs)("td",{children:[Object(M.jsx)("a",{href:"https://www.openstreetmap.org/#map=12/".concat(e.lat,"/").concat(e.lon),target:"_blank",rel:"noreferrer",children:"Map"})," ",Object(M.jsx)("a",{href:"https://www.openstreetmap.org/edit#map=20/".concat(e.lat,"/").concat(e.lon),target:"_blank",rel:"noreferrer",children:"Edit"})," ",Object(M.jsx)("a",{href:"https://www.openstreetmap.org/node/".concat(e.id),target:"_blank",rel:"noreferrer",children:"View"})," ",Object(M.jsx)("a",{href:"https://en.wikipedia.org/wiki/".concat(e.tags.name),target:"_blank",rel:"noreferrer",children:"Wikipedia"})," ",e.tags.wikidata&&Object(M.jsx)("a",{href:"https://www.wikidata.org/wiki/".concat(e.tags.wikidata),target:"_blank",rel:"noreferrer",children:"Wikidata"})]}),Object(M.jsx)("td",{children:!e.tags.population&&e.tags.wikidata&&Object(M.jsx)(ce,{id:e.tags.wikidata,claim:re.population})}),Object(M.jsx)("td",{children:!e.tags.population&&Object(M.jsx)(ne,{name:(null===(t=e.tags.wikipedia)||void 0===t?void 0:t.replace(/[a-z]+:/,""))||e.tags.name})})]},e.id)}))})]})})]})}function ee(e,t){var n=({city:{city:0,town:-1,village:-1},town:{city:1,town:0,village:-1},village:{city:1,town:1,village:0}}[e.tags.place]||{})[t.tags.place];return 0===n?String(e.tags.name).localeCompare(t.tags.name):n}function te(e){var t,n,r=e.population;return r>1e5?(t=12,n=_[0]):r>5e4?(t=6,n=_[1]):r>1e4?(t=4,n=_[2]):r>5e3&&(t=3,n=_[3]),Object(M.jsx)("svg",{width:24,height:24,viewBox:"-12 -12 24 24",style:{verticalAlign:"text-top"},children:Object(M.jsx)("circle",{r:t,fill:n})})}function ne(e){var t=e.name,n=Y("https://en.wikipedia.org/api/rest_v1/page/html/".concat(t)),r=Object(s.a)(n,3),c=r[0],a=r[1],o=r[2];if(a)return Object(M.jsx)("span",{style:{color:"red"},children:a.message});if(o)return Object(M.jsx)("span",{children:"Loading\u2026"});if(c){var i=(new DOMParser).parseFromString(c,"text/html").querySelector("[data-mw*=population_ref]");if(!i)return null;try{var l,u,h=JSON.parse(i.dataset.mw).parts[0].template.params,p=function(e){var t=/\[\[([^[\]]+)\]\]/.exec(e);if(t)return t[1].split("|")[0];return e.replace(/<.*>/,"").replace(/\[\[.*\]\]/,"").replace(/^\(|\)$/g,"")}(null===(l=h.population_ref)||void 0===l?void 0:l.wt);return Object(M.jsxs)("p",{children:[h.population.wt," ",(null===(u=h.population_ref)||void 0===u?void 0:u.wt.includes("Parish"))&&Object(M.jsx)("span",{style:{color:"#FF0000",fontSize:"0.8em"},children:"Parish"})," ",Object(M.jsx)("span",{style:{color:"#666",fontSize:"0.8em"},children:p})]})}catch(d){return console.error(d),Object(M.jsx)("p",{style:{color:"red"},children:"Error parsing"})}}return Object(M.jsx)("p",{style:{color:"red"},children:"Shouldn't be here"})}var re={pointInTime:"P585",population:"P1082"};function ce(e){var t=e.id,n=e.claim,r=Y("https://www.wikidata.org/wiki/Special:EntityData/".concat(t,".json")),c=Object(s.a)(r,3),a=c[0],o=c[1],i=c[2];if(o)return Object(M.jsx)("span",{style:{color:"red"},children:o.message});if(i)return Object(M.jsx)("span",{children:"Loading\u2026"});if(a)try{var l=a.entities[t].claims[n];if(l){l.sort(ae);var u=+l[0].mainsnak.datavalue.value.amount;return Object(M.jsx)("span",{children:u})}return null}catch(h){return Object(M.jsx)("span",{style:{color:"red"},children:h.message})}return Object(M.jsx)("span",{style:{color:"red"},children:"Shouldn't be here!?"})}function ae(e,t){var n,r,c=null===(n=e.qualifiers[re.pointInTime])||void 0===n?void 0:n[0].datavalue.value.time,a=null===(r=t.qualifiers[re.pointInTime])||void 0===r?void 0:r[0].datavalue.value.time;return-String(c).localeCompare(a)}var oe=Object(l.d)({accessToken:"pk.eyJ1IjoiaWptYWNkIiwiYSI6ImNqZ2J6dnNvYjM5Y3QzMnFkYWNybzM2bnkifQ.OE6IZdjeV6XK-NGACNu60g"}),ie=function(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(n){}return}("POPMESH_CENTRE_ZOOM"),se=ie?ie.slice(0,2):[-3.667,56.66],le=ie?ie.slice(2):[7],ue=[{id:"osm",label:"OpenStreetMap",coverage:"World"},{id:"nomis",label:"Nomis",coverage:"England and Wales"}];var he=function(){var e,t=Object(r.useState)([]),n=Object(s.a)(t,2),c=n[0],a=n[1],o=Object(r.useRef)(null),d=P("POPMESH_LOAD_ON_SCROLL",!1,!1),j=Object(s.a)(d,2),f=j[0],b=j[1],g=Object(r.useState)(!1),m=Object(s.a)(g,2),y=m[0],x=m[1],w=Object(r.useState)(null),_=Object(s.a)(w,2),E=_[0],N=_[1],T=Object(r.useState)(!1),H=Object(s.a)(T,2),V=H[0],A=H[1],D=P("POPMESH_DATA_SOURCE",ue[0].id,!1),B=Object(s.a)(D,2),U=B[0],J=B[1],W=Object(r.useState)(!1),z=Object(s.a)(W,2),G=z[0],Y=z[1],X=P("POPMESH_NODES_T1",!0,!1),K=Object(s.a)(X,2),Q=K[0],$=K[1],ee=P("POPMESH_VERTICES_T1",!0,!1),te=Object(s.a)(ee,2),ne=te[0],re=te[1],ce=P("POPMESH_VERTEX_LENGTH_T1",105e3,!1),ae=Object(s.a)(ce,2),ie=ae[0],he=ae[1],pe=P("POPMESH_SHAPES_T1",!1,!1),de=Object(s.a)(pe,2),je=de[0],fe=de[1],be=P("POPMESH_NODES_T2",!0,!1),Oe=Object(s.a)(be,2),ge=Oe[0],me=Oe[1],ye=P("POPMESH_VERTICES_T2",!0,!1),xe=Object(s.a)(ye,2),ve=xe[0],Se=xe[1],we=P("POPMESH_VERTEX_LENGTH_T2",1e5,!1),ke=Object(s.a)(we,2),Pe=ke[0],_e=ke[1],Ee=P("POPMESH_SHAPES_T2",!1,!1),Me=Object(s.a)(Ee,2),Ie=Me[0],Le=Me[1],Ce=P("POPMESH_NODES_T3",!0,!1),Ne=Object(s.a)(Ce,2),Te=Ne[0],He=Ne[1],Re=P("POPMESH_VERTICES_T3",!0,!1),Ve=Object(s.a)(Re,2),Ae=Ve[0],Fe=Ve[1],De=P("POPMESH_VERTEX_LENGTH_T3",95e3,!1),Be=Object(s.a)(De,2),Ue=Be[0],Je=Be[1],We=P("POPMESH_SHAPES_T3",!1,!1),ze=Object(s.a)(We,2),qe=ze[0],Ge=ze[1],Ye=P("POPMESH_NODES_T4",!0,!1),Xe=Object(s.a)(Ye,2),Ze=Xe[0],Ke=Xe[1],Qe=P("POPMESH_VERTICES_T4",!1,!1),$e=Object(s.a)(Qe,2),et=$e[0],tt=$e[1],nt=P("POPMESH_VERTEX_LENGTH_T4",9e4,!1),rt=Object(s.a)(nt,2),ct=rt[0],at=rt[1],ot=P("POPMESH_SHAPES_T4",!1,!1),it=Object(s.a)(ot,2),st=it[0],lt=it[1],ut=P("POPMESH_NARROW_ANGLE",15,!1),ht=Object(s.a)(ut,2),pt=ht[0],dt=ht[1],jt=P("POPMESH_CONURBATION_COLLAPSE",!1,!1),ft=Object(s.a)(jt,2),bt=ft[0],Ot=ft[1],gt=Object(r.useCallback)((function(){if(o.current){var e=o.current.getBounds().toArray().flat();"osm"===U?(q(e,{population:!0,place:["city","town","village"]}).then((function(e){a(e.elements),N(null)}),N).then((function(){return x(!1)})),x(!0)):"nomis"===U&&R(e).then(a)}}),[U]);Object(r.useEffect)(gt,[V,gt]);var mt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=Object(r.useRef)(!0);return Object(r.useCallback)((function(){n.current&&(e.apply(void 0,arguments),n.current=!1,setTimeout((function(){return n.current=!0}),t))}),[e,t])}(gt,5e3);Object(r.useEffect)((function(){function e(e){"p"===e.key&&e.altKey?Y((function(e){return!e})):"Escape"===e.key&&Y(!1)}return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}));var yt=c.length>0,xt=Object(r.useMemo)((function(){return bt?function(e,t){e.sort(v);var n,r=[],c=Object(u.a)(e);try{e:for(c.s();!(n=c.n()).done;){for(var a=n.value,o=0;o<r.length;o++){var i=r[o];if(O(a,i)<t){r[o]=S(a,i);continue e}}r.push(a)}}catch(s){c.e(s)}finally{c.f()}return r}(c,3500):c}),[bt,c]);Object(r.useEffect)((function(){function e(){!f&&yt||mt();var e=o.current.getCenter().toArray(),t=o.current.getZoom();localStorage.setItem("POPMESH_CENTRE_ZOOM",JSON.stringify([].concat(Object(i.a)(e),[t])))}if(o.current)return o.current.on("moveend",e),function(){o.current.off("moveend",e)}}),[mt,f,yt,V]);var vt=h(xt,1e5),St=ne?p(vt,ie,pt):[],wt=h(xt,5e4,1e5),kt=[].concat(Object(i.a)(vt),Object(i.a)(wt)),Pt=ve?p(kt,Pe,pt,St):[],_t=h(xt,1e4,5e4),Et=[].concat(Object(i.a)(vt),Object(i.a)(wt),Object(i.a)(_t)),Mt=[].concat(Object(i.a)(St),Object(i.a)(Pt)),It=Ae?p(Et,Ue,pt,Mt):[],Lt=h(xt,5e3,1e4),Ct=[].concat(Object(i.a)(vt),Object(i.a)(wt),Object(i.a)(_t),Object(i.a)(Lt)),Nt=[].concat(Object(i.a)(St),Object(i.a)(Pt),Object(i.a)(It)),Tt=et?p(Ct,ct,pt,Nt):[],Ht=F("nomis"===U&&je?vt.map((function(e){return e.id})):[]),Rt=F("nomis"===U&&Ie?wt.map((function(e){return e.id})):[]),Vt=F("nomis"===U&&qe?_t.map((function(e){return e.id})):[]),At=F("nomis"===U&&st?Lt.map((function(e){return e.id})):[]),Ft=null===(e=o.current)||void 0===e?void 0:e.getBounds().toArray().flat();return Object(M.jsxs)("div",{className:"App",children:[Object(M.jsxs)("div",{className:"Panel",children:[Object(M.jsxs)("label",{children:[Object(M.jsx)("span",{style:{fontWeight:"bold"},children:"Data Source"}),Object(M.jsx)("select",{value:U,onChange:function(e){return J(e.target.value)},children:ue.map((function(e){return Object(M.jsxs)("option",{value:e.id,children:[e.label," (",e.coverage,")"]},e.id)}))})]}),E?Object(M.jsx)("p",{style:{color:"red"},children:E.toString()}):y?Object(M.jsx)("p",{children:"Loading\u2026"}):Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("p",{children:Object(M.jsx)(L,{n:c.length,singular:"Total Place"})}),c.length!==xt.length&&Object(M.jsx)("p",{children:Object(M.jsx)(L,{n:xt.length,singular:"Conurbation"})})]}),Object(M.jsxs)("label",{children:[Object(M.jsx)("input",{type:"checkbox",checked:f,onChange:function(e){return b(e.target.checked)}}),"Load on pan/zoom"]}),Object(M.jsx)("button",{onClick:gt,children:"Load now"}),Object(M.jsx)(C,{label:"100k+",places:vt,connectors:St,showNodes:Q,setShowNodes:$,showVertices:ne,setShowVertices:re,maxVertexLength:ie,setMaxVertexLength:he,showShapes:je,setShowShapes:"nomis"===U?fe:null}),Object(M.jsx)(C,{label:"50k - 100k",places:wt,connectors:Pt,showNodes:ge,setShowNodes:me,showVertices:ve,setShowVertices:Se,maxVertexLength:Pe,setMaxVertexLength:_e,showShapes:Ie,setShowShapes:"nomis"===U?Le:null}),Object(M.jsx)(C,{label:"10k - 50k",places:_t,connectors:It,showNodes:Te,setShowNodes:He,showVertices:Ae,setShowVertices:Fe,maxVertexLength:Ue,setMaxVertexLength:Je,showShapes:qe,setShowShapes:"nomis"===U?Ge:null}),Object(M.jsx)(C,{label:"5k - 10k",places:Lt,connectors:Tt,showNodes:Ze,setShowNodes:Ke,showVertices:et,setShowVertices:tt,maxVertexLength:ct,setMaxVertexLength:at,showShapes:st,setShowShapes:"nomis"===U?lt:null}),Object(M.jsx)("h2",{children:"Options"}),Object(M.jsxs)("label",{children:["Narrow Angle Limit "," ",Object(M.jsx)("input",{type:"number",min:0,max:180,value:pt,onChange:function(e){return dt(e.target.valueAsNumber)}})," ","(degrees)"]}),Object(M.jsxs)("label",{children:["Collapse Conurbations"," ",Object(M.jsx)("input",{type:"checkbox",checked:bt,onChange:function(e){return Ot(e.target.checked)}})]}),Object(M.jsx)("h2",{children:"Download"}),Object(M.jsx)("button",{onClick:function(){var e=[];je?e.push({label:"100k+",shapes:Ht,style:"tier1_shapes"}):Q&&e.push({label:"100k+",points:vt,style:"tier1_places"}),Ie?e.push({label:"50k - 100k",shapes:Rt,style:"tier2_shapes"}):ge&&e.push({label:"50k - 100k",points:wt,style:"tier2_places"}),qe?e.push({label:"10k - 50k",shapes:Vt,style:"tier3_shapes"}):Te&&e.push({label:"10k - 50k",points:_t,style:"tier3_places"}),st?e.push({label:"5k - 10k",shapes:At,style:"tier4_shapes"}):Ze&&e.push({label:"5k - 10k",points:Lt,style:"tier4_places"}),ne&&e.push({label:"Connections 100k+",lines:St,style:"tier1_connectors"}),ve&&e.push({label:"Connections 50k - 100k",lines:Pt,style:"tier2_connectors"}),Ae&&e.push({label:"Connections 10k - 50k",lines:It,style:"tier3_connectors"}),et&&e.push({label:"Connections 5k - 10k",lines:Tt,style:"tier4_connectors"}),function(e,t){var n=new Blob([t]),r=window.URL.createObjectURL(n),c=document.createElement("a");c.href=r,c.download=e,document.body.append(c),c.click(),setTimeout((function(){document.body.removeChild(c),window.URL.revokeObjectURL(r)}))}("places.kml",k(e))},children:"kml"})]}),Object(M.jsxs)(oe,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"100vh",width:"100vw"},onSourceData:function(e){o.current||A(!0),o.current=e},center:se,zoom:le,children:[Object(M.jsx)(I,{places:Q&&!je?vt:[],connectors:St,tier:1,shapes:Ht}),Object(M.jsx)(I,{places:ge&&!Ie?wt:[],connectors:Pt,tier:2,shapes:Rt}),Object(M.jsx)(I,{places:Te&&!qe?_t:[],connectors:It,tier:3,shapes:Vt}),Object(M.jsx)(I,{places:Ze&&!st?Lt:[],connectors:Tt,tier:4,shapes:At}),Object(M.jsx)(l.c,{}),Object(M.jsx)(l.b,{})]}),G&&Object(M.jsx)(Z,{bounds:Ft,sourceID:U})]})};var pe=n(9),de=n(10),je=n(31),fe=n(30),be=function(e){Object(je.a)(n,e);var t=Object(fe.a)(n);function n(){var e;return Object(pe.a)(this,n),(e=t.call(this)).state={error:null},e}return Object(de.a)(n,[{key:"componentDidCatch",value:function(e){this.setState({error:e})}},{key:"render",value:function(){if(this.state.error){var e=this.state.error instanceof Error?this.state.error.message:this.state.error.toString(),t=this.state.error instanceof Error?encodeURI(this.state.error.stack):"";return Object(M.jsxs)("div",{style:{margin:20},children:[Object(M.jsx)("h1",{style:{color:"#999"},children:"Sorry Population Mesh has crashed"}),Object(M.jsx)("p",{style:{color:"#666"},children:"This was slightly unexpected. Apologies for that."}),Object(M.jsx)("p",{style:{color:"#666"},children:"Population Mesh is still a work in progress so may crash occasionally."}),Object(M.jsxs)("p",{style:{color:"#666"},children:["If you feel so inclined you can report this bug at ",Object(M.jsx)("a",{href:"https://github.com/IJMacD/population-mesh/issues/new?title=".concat(e,"&body=").concat(t),children:"GitHub"}),"."]}),Object(M.jsx)("p",{style:{color:"#666"},children:Object(M.jsx)(Oe,{error:this.state.error})})]})}return this.props.children}}]),n}(r.Component);function Oe(e){var t=e.error;return t instanceof Error?Object(M.jsx)("code",{style:{whiteSpace:"pre"},children:t.stack||t.message}):Object(M.jsx)("code",{children:t.toString()})}o.a.render(Object(M.jsx)(c.a.StrictMode,{children:Object(M.jsx)(be,{children:Object(M.jsx)(he,{})})}),document.getElementById("root"))}},[[61,1,2]]]);
//# sourceMappingURL=main.815cd1ae.chunk.js.map