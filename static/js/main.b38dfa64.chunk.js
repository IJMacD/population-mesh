(this["webpackJsonppopulation-mesh"]=this["webpackJsonppopulation-mesh"]||[]).push([[0],{30:function(e,t,n){},31:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var c=n(0),o=n.n(c),a=n(11),r=n.n(a),s=(n(30),n(3)),i=n(2),l=(n(31),n(6)),u=(n(52),n(5));function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return e.filter((function(e){return t<=+e.tags.population&&+e.tags.population<n}))}function f(e,t,n){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=b(e,t);return n>0&&(o=d(o,n)),c.length>0&&(o=S(o,c)),o}function b(e,t){var n,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=[],a=Object(u.a)(e);try{for(a.s();!(n=a.n()).done;){var r,s=n.value,i=Object(u.a)(e);try{for(i.s();!(r=i.n()).done;){var l=r.value;if(s.id<l.id){var h=O(s,l);h<t&&!j(s,l,c)&&o.push([s,l])}}}catch(f){i.e(f)}finally{i.f()}}}catch(f){a.e(f)}finally{a.f()}return o}function j(e,t,n){var c,o=e.id<t.id?e:t,a=e.id<t.id?t:e,r=Object(u.a)(n);try{for(r.s();!(c=r.n()).done;){var s=Object(i.a)(c.value,2),l=s[0],h=s[1];if(o===l&&a===h)return!0}}catch(f){r.e(f)}finally{r.f()}return!1}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t<=0)return e;e.sort(p);var n,c=[],o=Object(u.a)(e);try{for(o.s();!(n=o.n()).done;){var a,r=n.value,s=!0,i=Object(u.a)(c);try{for(i.s();!(a=i.n()).done;){var l=a.value,h=g(r,l);if(h){var f=m([h[1],h[0]],[h[1],h[2]]);if(f<t){s=!1;break}}}}catch(b){i.e(b)}finally{i.f()}s&&c.push(r)}}catch(b){o.e(b)}finally{o.f()}return c}function p(e,t){return O(e[0],e[1])-O(t[0],t[1])}function O(e,t){var n=e.lat*Math.PI/180,c=t.lat*Math.PI/180,o=(t.lat-e.lat)*Math.PI/180,a=(t.lon-e.lon)*Math.PI/180,r=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(c)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function m(e,t){var n=y(e[0],e[1]),c=y(t[0],t[1]),o=Math.abs(c-n);return o>180?180-(o-180):o}function y(e,t){var n=e.lat*Math.PI/180,c=t.lat*Math.PI/180,o=(t.lon-e.lon)*Math.PI/180,a=Math.cos(c)*Math.sin(o),r=Math.cos(n)*Math.sin(c)-Math.sin(n)*Math.cos(c)*Math.cos(o);return 180*Math.atan2(r,a)/Math.PI}function S(e,t){return e.filter((function(e){return"undefined"===typeof t.find((function(t){return e[0]===t[0]&&e[1]===t[1]}))}))}function g(e,t){return e[0]===t[0]?[e[1],e[0],t[1]]:e[0]===t[1]?[e[1],e[0],t[0]]:e[1]===t[0]?[e[0],e[1],t[1]]:e[1]===t[1]?[e[0],e[1],t[0]]:void 0}function x(e){return'<?xml version="1.0" encoding="UTF-8"?>\n<kml xmlns="http://www.opengis.net/kml/2.2">\n    <Document>\n        <Style id="tier1_places">\n            <IconStyle>\n                <color>ffffff00</color>\n                <scale>2</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier2_places">\n            <IconStyle>\n                <color>ffcf9a02</color>\n                <scale>1.6666</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier3_places">\n            <IconStyle>\n                <color>ffff7f00</color>\n                <scale>1.25</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier4_places">\n            <IconStyle>\n                <color>ffcc0000</color>\n                <scale>1</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier1_connectors">\n            <LineStyle>\n                <color>ffffff00</color>\n                <width>5</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier2_connectors">\n            <LineStyle>\n                <color>ffcf9a02</color>\n                <width>4</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier3_connectors">\n            <LineStyle>\n                <color>ffff7f00</color>\n                <width>3</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier4_connectors">\n            <LineStyle>\n                <color>ffcc0000</color>\n                <width>2</width>\n            </LineStyle>\n        </Style>\n        '.concat(e.map((function(e){return function(e){return"\n    <Folder>\n        <name>".concat(e.label,"</name>\n        ").concat(e.points?e.points.map((function(t){return n=t,c=e.style,"\n        <Placemark>\n            <name>".concat(n.tags.name,"</name>\n            <description>Population: ").concat(n.tags.population,"</description>\n            <styleUrl>#").concat(c,"</styleUrl>\n            <Point>\n                <coordinates>").concat(n.lon,",").concat(n.lat,",0</coordinates>\n            </Point>\n        </Placemark>");var n,c})).join(""):"","\n        ").concat(e.lines?e.lines.map((function(t){return function(e,t){var n=Object(i.a)(e,2),c=n[0],o=n[1];return"\n        <Placemark>\n            <name>From ".concat(c.tags.name," to ").concat(o.tags.name,"</name>\n            <description>Distance: ").concat(O(c,o).toFixed(0),"m</description>\n            <styleUrl>#").concat(t,"</styleUrl>\n            <LineString>\n                <coordinates>\n                    ").concat(c.lon,",").concat(c.lat,",0\n                    ").concat(o.lon,",").concat(o.lat,",0\n                </coordinates>\n            </LineString>\n        </Placemark>")}(t,e.style)})).join(""):"","\n    </Folder>")}(e)})).join(""),"\n    </Document>\n</kml>")}function v(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=Object(c.useState)((function(){var n=localStorage.getItem(e);if(n)try{return JSON.parse(n)}catch(c){}return t instanceof Function?t():t})),a=Object(i.a)(o,2),r=a[0],s=a[1];Object(c.useEffect)((function(){if(n){var t=function(t){if(t.key===e)try{s(JSON.parse(t.newValue))}catch(t){}};return window.addEventListener("storage",t),function(){return window.removeEventListener("storage",t)}}}),[e,n]);var l=Object(c.useCallback)((function(t){s(t),localStorage.setItem(e,JSON.stringify(t))}),[s,e]);return[r,l]}var k=["#00FFFF","#029ACF","#007FFF","#0000CC"];function w(e,t){return{type:"FeatureCollection",features:[].concat(Object(s.a)(e.map((function(e){return{geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{name:e.tags.name}}}))),Object(s.a)(t.map((function(e){var t=Object(i.a)(e,2),n=t[0],c=t[1];return{geometry:{type:"LineString",coordinates:[[n.lon,n.lat],[c.lon,c.lat]]},properties:{name:"From ".concat(n.tags.name," to ").concat(c.tags.name)}}}))))}}var P=n(1);function M(e){var t=e.places,n=void 0===t?[]:t,c=e.connectors,o=void 0===c?[]:c,a=e.tier,r=w(n,[]),s=w([],o),i=function(e){return{"circle-radius":{base:5/e,stops:[[12,10/e],[22,180/e]]},"circle-color":k[e-1]}}(a),u=function(e){return{"line-width":{base:3/e,stops:[[12,5/e],[22,90/e]]},"line-color":k[e-1]}}(a);return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(l.a,{data:r,circlePaint:i}),Object(P.jsx)(l.a,{data:s,linePaint:u})]})}function E(e){var t=e.n,n=e.singular,c=e.plural,o=void 0===c?null:c;return Object(P.jsx)(P.Fragment,{children:"".concat(t," ").concat(1===t?n:o||n+"s")})}function _(e){var t=e.label,n=e.places,c=e.connectors,o=e.showNodes,a=e.setShowNodes,r=e.showVertices,s=e.setShowVertices,i=e.maxVertexLength,l=e.setMaxVertexLength;return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)("h2",{children:t}),Object(P.jsxs)("label",{children:[Object(P.jsx)("input",{type:"checkbox",checked:o,onChange:function(e){return a(e.target.checked)}}),Object(P.jsx)(E,{n:n.length,singular:"Place"})]}),Object(P.jsxs)("label",{children:[Object(P.jsx)("input",{type:"checkbox",checked:r,onChange:function(e){return s(e.target.checked)}}),Object(P.jsx)(E,{n:c.length,singular:"Connection"})]}),Object(P.jsxs)("label",{children:["Max Connection Length (km)",Object(P.jsx)("input",{type:"number",min:0,value:i/1e3,onChange:function(e){return l(1e3*e.target.valueAsNumber)}})]})]})}var L=Object(l.d)({accessToken:"pk.eyJ1IjoiaWptYWNkIiwiYSI6ImNqZ2J6dnNvYjM5Y3QzMnFkYWNybzM2bnkifQ.OE6IZdjeV6XK-NGACNu60g"}),N=function(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(n){}return}("POPMESH_CENTRE_ZOOM"),I=N?N.slice(0,2):[-3.667,56.66],T=N?N.slice(2):[7];var V=function(){var e=Object(c.useState)([]),t=Object(i.a)(e,2),n=t[0],o=t[1],a=Object(c.useRef)(null),r=v("POPMESH_LOAD_ON_SCROLL",!1),u=Object(i.a)(r,2),b=u[0],j=u[1],d=Object(c.useState)(!1),p=Object(i.a)(d,2),O=p[0],m=p[1],y=Object(c.useState)(null),S=Object(i.a)(y,2),g=S[0],k=S[1],w=Object(c.useState)(!1),N=Object(i.a)(w,2),V=N[0],F=N[1],H=v("POPMESH_NODES_T1",!0,!1),R=Object(i.a)(H,2),A=R[0],D=R[1],J=v("POPMESH_VERTICES_T1",!0,!1),U=Object(i.a)(J,2),G=U[0],X=U[1],Y=v("POPMESH_VERTEX_LENGTH_T1",105e3,!1),Z=Object(i.a)(Y,2),q=Z[0],z=Z[1],W=v("POPMESH_NODES_T2",!0,!1),B=Object(i.a)(W,2),Q=B[0],K=B[1],$=v("POPMESH_VERTICES_T2",!0,!1),ee=Object(i.a)($,2),te=ee[0],ne=ee[1],ce=v("POPMESH_VERTEX_LENGTH_T2",1e5,!1),oe=Object(i.a)(ce,2),ae=oe[0],re=oe[1],se=v("POPMESH_NODES_T3",!0,!1),ie=Object(i.a)(se,2),le=ie[0],ue=ie[1],he=v("POPMESH_VERTICES_T3",!0,!1),fe=Object(i.a)(he,2),be=fe[0],je=fe[1],de=v("POPMESH_VERTEX_LENGTH_T3",95e3,!1),pe=Object(i.a)(de,2),Oe=pe[0],me=pe[1],ye=v("POPMESH_NODES_T4",!0,!1),Se=Object(i.a)(ye,2),ge=Se[0],xe=Se[1],ve=v("POPMESH_VERTICES_T4",!1,!1),ke=Object(i.a)(ve,2),we=ke[0],Pe=ke[1],Me=v("POPMESH_VERTEX_LENGTH_T4",9e4,!1),Ee=Object(i.a)(Me,2),_e=Ee[0],Le=Ee[1],Ne=v("POPMESH_NARROW_ANGLE",20,!1),Ie=Object(i.a)(Ne,2),Te=Ie[0],Ve=Ie[1],Ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=Object(c.useRef)(!0);return Object(c.useCallback)((function(){n.current&&(e.apply(void 0,arguments),n.current=!1,setTimeout((function(){return n.current=!0}),t))}),[e,t])}(Fe,5e3);function Fe(){a.current&&(function(e){var t=e.map((function(e){return e.toFixed(3)})).join(",");return function(e){var t=C.find((function(t){return t.url===e}));t||(t={url:e,result:fetch(e).then((function(e){return e.ok?e.json():429===e.status?Promise.reject("Too many requests. Please wait a minute."):Promise.reject("Error fetching data")}))},C.unshift(t),C.length=Math.min(10,C.length));return t.result}('https://overpass-api.de/api/interpreter?data=[out:json][bbox];(node[population];-node[place~"^country|state$"];);out;&bbox='.concat(t))}(a.current.getBounds().toArray().flat()).then((function(e){o(e.elements),k(null)}),k).then((function(){return m(!1)})),m(!0))}var He=n.length>0;Object(c.useEffect)((function(){function e(){!b&&He||Ce();var e=a.current.getCenter().toArray(),t=a.current.getZoom();localStorage.setItem("POPMESH_CENTRE_ZOOM",JSON.stringify([].concat(Object(s.a)(e),[t])))}if(a.current)return a.current.on("sourcedata",e),function(){a.current.off("sourcedata",e)}}),[Ce,b,He,V]);var Re=h(n,1e5),Ae=G?f(Re,q,Te):[],De=h(n,5e4,1e5),Je=[].concat(Object(s.a)(Re),Object(s.a)(De)),Ue=te?f(Je,ae,Te,Ae):[],Ge=h(n,1e4,5e4),Xe=[].concat(Object(s.a)(Re),Object(s.a)(De),Object(s.a)(Ge)),Ye=[].concat(Object(s.a)(Ae),Object(s.a)(Ue)),Ze=be?f(Xe,Oe,Te,Ye):[],qe=h(n,5e3,1e4),ze=[].concat(Object(s.a)(Re),Object(s.a)(De),Object(s.a)(Ge),Object(s.a)(qe)),We=[].concat(Object(s.a)(Ae),Object(s.a)(Ue),Object(s.a)(Ze)),Be=we?f(ze,_e,Te,We):[];return Object(P.jsxs)("div",{className:"App",children:[Object(P.jsxs)("div",{className:"Panel",children:[g?Object(P.jsx)("p",{style:{color:"red"},children:g.toString()}):Object(P.jsx)("p",{children:O?"Loading\u2026":Object(P.jsx)(E,{n:n.length,singular:"Total Place"})}),Object(P.jsxs)("label",{children:[Object(P.jsx)("input",{type:"checkbox",checked:b,onChange:function(e){return j(e.target.checked)}}),"Load on pan/zoom"]}),Object(P.jsx)("button",{onClick:Fe,children:"Load now"}),Object(P.jsx)(_,{label:"100k+",places:Re,connectors:Ae,showNodes:A,setShowNodes:D,showVertices:G,setShowVertices:X,maxVertexLength:q,setMaxVertexLength:z}),Object(P.jsx)(_,{label:"50k - 100k",places:De,connectors:Ue,showNodes:Q,setShowNodes:K,showVertices:te,setShowVertices:ne,maxVertexLength:ae,setMaxVertexLength:re}),Object(P.jsx)(_,{label:"10k - 50k",places:Ge,connectors:Ze,showNodes:le,setShowNodes:ue,showVertices:be,setShowVertices:je,maxVertexLength:Oe,setMaxVertexLength:me}),Object(P.jsx)(_,{label:"5k - 10k",places:qe,connectors:Be,showNodes:ge,setShowNodes:xe,showVertices:we,setShowVertices:Pe,maxVertexLength:_e,setMaxVertexLength:Le}),Object(P.jsx)("h2",{children:"Options"}),Object(P.jsxs)("label",{children:["Narrow Angle Limit (degrees)",Object(P.jsx)("input",{type:"number",min:0,max:180,value:Te,onChange:function(e){return Ve(e.target.valueAsNumber)}})]}),Object(P.jsx)("h2",{children:"Download"}),Object(P.jsx)("button",{onClick:function(){var e=[];A&&e.push({label:"100k+",points:Re,style:"tier1_places"}),Q&&e.push({label:"50k - 100k",points:De,style:"tier2_places"}),le&&e.push({label:"10k - 50k",points:Ge,style:"tier3_places"}),ge&&e.push({label:"5k - 10k",points:qe,style:"tier4_places"}),G&&e.push({label:"Connections 100k+",lines:Ae,style:"tier1_connectors"}),te&&e.push({label:"Connections 50k - 100k",lines:Ue,style:"tier2_connectors"}),be&&e.push({label:"Connections 10k - 50k",lines:Ze,style:"tier3_connectors"}),we&&e.push({label:"Connections 5k - 10k",lines:Be,style:"tier4_connectors"}),function(e,t){var n=new Blob([t]),c=window.URL.createObjectURL(n),o=document.createElement("a");o.href=c,o.download=e,document.body.append(o),o.click(),setTimeout((function(){document.body.removeChild(o),window.URL.revokeObjectURL(c)}))}("places.kml",x(e))},children:"kml"})]}),Object(P.jsxs)(L,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"100vh",width:"100vw"},onSourceData:function(e){a.current||F(!0),a.current=e},center:I,zoom:T,children:[Object(P.jsx)(M,{places:ge?qe:[],connectors:Be,tier:4}),Object(P.jsx)(M,{places:le?Ge:[],connectors:Ze,tier:3}),Object(P.jsx)(M,{places:Q?De:[],connectors:Ue,tier:2}),Object(P.jsx)(M,{places:A?Re:[],connectors:Ae,tier:1}),Object(P.jsx)(l.c,{}),Object(P.jsx)(l.b,{})]})]})};var C=[];r.a.render(Object(P.jsx)(o.a.StrictMode,{children:Object(P.jsx)(V,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.b38dfa64.chunk.js.map