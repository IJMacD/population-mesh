(this["webpackJsonppopulation-mesh"]=this["webpackJsonppopulation-mesh"]||[]).push([[0],{36:function(e,t,n){},37:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),a=n(13),o=n.n(a),i=(n(36),n(3)),s=n(2),l=(n(37),n(6)),u=(n(58),n(5));function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return e.filter((function(e){return t<=+e.tags.population&&+e.tags.population<n}))}function d(e,t,n){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=h(e,t);return n>0&&(r=b(r,n)),c.length>0&&(r=m(r,c)),r}function h(e,t){var n,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=[],a=Object(u.a)(e);try{for(a.s();!(n=a.n()).done;){var o,i=n.value,s=Object(u.a)(e);try{for(s.s();!(o=s.n()).done;){var l=o.value;if(i.id<l.id){var j=O(i,l);j<t&&!p(i,l,c)&&r.push([i,l])}}}catch(d){s.e(d)}finally{s.f()}}}catch(d){a.e(d)}finally{a.f()}return r}function p(e,t,n){var c,r=e.id<t.id?e:t,a=e.id<t.id?t:e,o=Object(u.a)(n);try{for(o.s();!(c=o.n()).done;){var i=Object(s.a)(c.value,2),l=i[0],j=i[1];if(r===l&&a===j)return!0}}catch(d){o.e(d)}finally{o.f()}return!1}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t<=0)return e;e.sort(f);var n,c=[],r=Object(u.a)(e);try{for(r.s();!(n=r.n()).done;){var a,o=n.value,i=!0,s=Object(u.a)(c);try{for(s.s();!(a=s.n()).done;){var l=a.value,j=v(o,l);if(j){var d=g([j[1],j[0]],[j[1],j[2]]);if(d<t){i=!1;break}}}}catch(h){s.e(h)}finally{s.f()}i&&c.push(o)}}catch(h){r.e(h)}finally{r.f()}return c}function f(e,t){return O(e[0],e[1])-O(t[0],t[1])}function O(e,t){var n=e.lat*Math.PI/180,c=t.lat*Math.PI/180,r=(t.lat-e.lat)*Math.PI/180,a=(t.lon-e.lon)*Math.PI/180,o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(n)*Math.cos(c)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}function g(e,t){var n=x(e[0],e[1]),c=x(t[0],t[1]),r=Math.abs(c-n);return r>180?180-(r-180):r}function x(e,t){var n=e.lat*Math.PI/180,c=t.lat*Math.PI/180,r=(t.lon-e.lon)*Math.PI/180,a=Math.cos(c)*Math.sin(r),o=Math.cos(n)*Math.sin(c)-Math.sin(n)*Math.cos(c)*Math.cos(r);return 180*Math.atan2(o,a)/Math.PI}function m(e,t){return e.filter((function(e){return"undefined"===typeof t.find((function(t){return e[0]===t[0]&&e[1]===t[1]}))}))}function v(e,t){return e[0]===t[0]?[e[1],e[0],t[1]]:e[0]===t[1]?[e[1],e[0],t[0]]:e[1]===t[0]?[e[0],e[1],t[1]]:e[1]===t[1]?[e[0],e[1],t[0]]:void 0}function y(e,t){return+t.tags.population-+e.tags.population}function S(e,t){var n=function(e,t){var n=+e.tags.population>+t.tags.population?"".concat(e.tags.name," and ").concat(t.tags.name):"".concat(t.tags.name," and ").concat(e.tags.name);return/ and .+ and /.test(n)?n.replace(/ and /,", "):n}(e,t),c=+e.tags.population,r=+t.tags.population,a=c+r,o=a.toString(),i=r/a;return{id:Math.min(e.id,t.id),lat:w(e.lat,t.lat,i),lon:w(e.lon,t.lon,i),type:"node",tags:{name:n,population:o}}}function w(e,t,n){return e+n*(t-e)}function k(e){return'<?xml version="1.0" encoding="UTF-8"?>\n<kml xmlns="http://www.opengis.net/kml/2.2">\n    <Document>\n        <Style id="tier1_places">\n            <IconStyle>\n                <color>ffffff00</color>\n                <scale>2</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier2_places">\n            <IconStyle>\n                <color>ffcf9a02</color>\n                <scale>1.6666</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier3_places">\n            <IconStyle>\n                <color>ffff7f00</color>\n                <scale>1.25</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier4_places">\n            <IconStyle>\n                <color>ffcc0000</color>\n                <scale>1</scale>\n                <Icon>\n                    <href>http://maps.google.com/mapfiles/kml/paddle/wht-blank.png</href>\n                </Icon>\n                <hotSpot x="32" y="1" xunits="pixels" yunits="pixels"/>\n            </IconStyle>\n        </Style>\n        <Style id="tier1_connectors">\n            <LineStyle>\n                <color>ffffff00</color>\n                <width>5</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier2_connectors">\n            <LineStyle>\n                <color>ffcf9a02</color>\n                <width>4</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier3_connectors">\n            <LineStyle>\n                <color>ffff7f00</color>\n                <width>3</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier4_connectors">\n            <LineStyle>\n                <color>ffcc0000</color>\n                <width>2</width>\n            </LineStyle>\n        </Style>\n        '.concat(e.map((function(e){return function(e){return"\n    <Folder>\n        <name>".concat(e.label,"</name>\n        ").concat(e.points?e.points.map((function(t){return n=t,c=e.style,"\n        <Placemark>\n            <name>".concat(n.tags.name,"</name>\n            <description>Population: ").concat(n.tags.population,"</description>\n            <styleUrl>#").concat(c,"</styleUrl>\n            <Point>\n                <coordinates>").concat(n.lon,",").concat(n.lat,",0</coordinates>\n            </Point>\n        </Placemark>");var n,c})).join(""):"","\n        ").concat(e.lines?e.lines.map((function(t){return function(e,t){var n=Object(s.a)(e,2),c=n[0],r=n[1];return"\n        <Placemark>\n            <name>".concat(c.tags.name," to ").concat(r.tags.name,"</name>\n            <description>Distance: ").concat(O(c,r).toFixed(0),"m</description>\n            <styleUrl>#").concat(t,"</styleUrl>\n            <LineString>\n                <coordinates>\n                    ").concat(c.lon,",").concat(c.lat,",0\n                    ").concat(r.lon,",").concat(r.lat,",0\n                </coordinates>\n            </LineString>\n        </Placemark>")}(t,e.style)})).join(""):"","\n    </Folder>")}(e)})).join(""),"\n    </Document>\n</kml>")}function E(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Object(c.useState)((function(){var n=localStorage.getItem(e);if(n)try{return JSON.parse(n)}catch(c){}return t instanceof Function?t():t})),a=Object(s.a)(r,2),o=a[0],i=a[1];Object(c.useEffect)((function(){if(n){var t=function(t){if(t.key===e)try{i(JSON.parse(t.newValue))}catch(t){}};return window.addEventListener("storage",t),function(){return window.removeEventListener("storage",t)}}}),[e,n]);var l=Object(c.useCallback)((function(t){i(t),localStorage.setItem(e,JSON.stringify(t))}),[i,e]);return[o,l]}var P=["#00FFFF","#029ACF","#007FFF","#0000CC"];function _(e,t){return{type:"FeatureCollection",features:[].concat(Object(i.a)(e.map((function(e){return{geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{name:e.tags.name}}}))),Object(i.a)(t.map((function(e){var t=Object(s.a)(e,2),n=t[0],c=t[1];return{geometry:{type:"LineString",coordinates:[[n.lon,n.lat],[c.lon,c.lat]]},properties:{name:"From ".concat(n.tags.name," to ").concat(c.tags.name)}}}))))}}var M=n(0);function I(e){var t=e.places,n=void 0===t?[]:t,c=e.connectors,r=void 0===c?[]:c,a=e.tier,o=_(n,[]),i=_([],r),s=function(e){return{"circle-radius":{base:5/e,stops:[[12,10/e],[22,180/e]]},"circle-color":P[e-1]}}(a),u=function(e){return{"line-width":{base:3/e,stops:[[12,5/e],[22,90/e]]},"line-color":P[e-1]}}(a);return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(l.a,{data:o,circlePaint:s}),Object(M.jsx)(l.a,{data:i,linePaint:u})]})}function L(e){var t=e.n,n=e.singular,c=e.plural,r=void 0===c?null:c;return Object(M.jsx)(M.Fragment,{children:"".concat(t," ").concat(1===t?n:r||n+"s")})}function C(e){var t=e.label,n=e.places,c=e.connectors,r=e.showNodes,a=e.setShowNodes,o=e.showVertices,i=e.setShowVertices,s=e.maxVertexLength,l=e.setMaxVertexLength;return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("h2",{children:t}),Object(M.jsxs)("label",{children:[Object(M.jsx)("input",{type:"checkbox",checked:r,onChange:function(e){return a(e.target.checked)}}),Object(M.jsx)(L,{n:n.length,singular:"Place"})]}),Object(M.jsxs)("label",{children:[Object(M.jsx)("input",{type:"checkbox",checked:o,onChange:function(e){return i(e.target.checked)}}),Object(M.jsx)(L,{n:c.length,singular:"Connection"})]}),Object(M.jsxs)("label",{children:["Max Connection Length (km)",Object(M.jsx)("input",{type:"number",min:0,value:s/1e3,onChange:function(e){return l(1e3*e.target.valueAsNumber)}})]})]})}var N=n(20),T=n.n(N),V=n(29);function F(e){return H.apply(this,arguments)}function H(){return(H=Object(V.a)(T.a.mark((function e(t){var c,r;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(3).then(n.t.bind(null,62,3));case 2:return c=e.sent.default,r=c.filter((function(e){return R(e,t)})),e.abrupt("return",r.map((function(e){return{id:e.id,type:"node",lat:e.lat,lon:e.lon,tags:{name:e.name,population:e.pop.toString(),place:"built_up_area"}}})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){return e.lon>=t[0]&&e.lon<t[2]&&e.lat>=t[1]&&e.lat<t[3]}function A(e,t){var n=e.map((function(e){return e.toFixed(3)})).join(","),c=Object.entries(t).map((function(e){var t=Object(s.a)(e,2),n=t[0],c=t[1];return!0===c?"[".concat(n,"]"):Array.isArray(c)?"[".concat(n,'~"^').concat(c.join("|"),'$"]'):"[".concat(n,'="').concat(c,'"]')})).join("");if(!c)throw new Error("Too many nodes");return function(e){var t=D.find((function(t){return t.url===e}));t||(t={url:e,result:fetch(e).then((function(e){return e.ok?e.json():429===e.status?Promise.reject("Too many requests. Please wait a minute."):Promise.reject("Error fetching data")}))},D.unshift(t),D.length=Math.min(10,D.length));return t.result}("https://overpass-api.de/api/interpreter?data=[out:json][bbox];node".concat(c,";out ").concat(1e4,";&bbox=").concat(n))}var D=[];function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=Object(c.useState)(null),r=Object(s.a)(n,2),a=r[0],o=r[1],i=Object(c.useState)(null),l=Object(s.a)(i,2),u=l[0],j=l[1],d=Object(c.useState)(!1),h=Object(s.a)(d,2),p=h[0],b=h[1];return Object(c.useEffect)((function(){fetch(e,t).then((function(e){return e.ok?e.headers.get("Content-Type").includes("application/json")?e.json():e.text():Promise.reject("Error fetching data")})).then((function(e){o(e),j(null)}),j).then((function(){return b(!1)})),b(!0)}),[e,t]),[a,u,p]}var J={place:["city","town","village"]};function W(e){var t=e.bounds,n=e.sourceID;return"osm"===n?Object(M.jsx)(z,{bounds:t}):"nomis"===n?Object(M.jsx)(q,{bounds:t}):null}function z(e){var t=function(e,t){var n=Object(c.useState)([]),r=Object(s.a)(n,2),a=r[0],o=r[1],i=Object(c.useState)(null),l=Object(s.a)(i,2),u=l[0],j=l[1],d=Object(c.useState)(!1),h=Object(s.a)(d,2),p=h[0],b=h[1];return Object(c.useEffect)((function(){A(e,t).then((function(e){o(e.elements),j(null)}),j).then((function(){return b(!1)})),b(!0)}),[e,t]),[a,u,p]}(e.bounds,J),n=Object(s.a)(t,3),r=n[0],a=n[1],o=n[2];return Object(M.jsx)(G,{data:r,error:a,loading:o})}function q(e){var t=e.bounds,n=Object(c.useState)([]),r=Object(s.a)(n,2),a=r[0],o=r[1],i=Object(c.useState)(null),l=Object(s.a)(i,2),u=l[0],j=l[1],d=Object(c.useState)(!1),h=Object(s.a)(d,2),p=h[0],b=h[1];return Object(c.useEffect)((function(){F(t).then(o,j).then((function(){return b(!1)})),b(!0)}),t),Object(M.jsx)(G,{data:a,error:u,loading:p})}function G(e){var t=e.data,n=e.error,c=e.loading;t.sort(B);return Object(M.jsxs)("section",{style:{backgroundColor:"white",width:"80%",position:"fixed",height:"90%",top:"5%",left:"10%",borderRadius:30,padding:20,boxSizing:"border-box",boxShadow:"-10px -10px 60px rgba(0,0,0,0.6), 15px 15px 20px rgba(0,0,0,0.6)",display:"flex",flexDirection:"column"},children:[Object(M.jsx)("h1",{children:"Population Inspector"}),c&&Object(M.jsx)("p",{children:"Loading\u2026"}),n&&Object(M.jsx)("p",{style:{color:"red"},children:n.toString()}),t.length>0&&Object(M.jsx)("div",{style:{flex:1,overflowY:"auto"},children:Object(M.jsxs)("table",{children:[Object(M.jsx)("thead",{children:Object(M.jsxs)("tr",{children:[Object(M.jsx)("th",{children:"Name"}),Object(M.jsx)("th",{children:"Type"}),Object(M.jsx)("th",{children:"Population"}),Object(M.jsx)("th",{children:"Links"}),Object(M.jsx)("th",{children:"Wikidata"}),Object(M.jsx)("th",{children:"Wikipedia"})]})}),Object(M.jsx)("tbody",{children:t.map((function(e){var t;return Object(M.jsxs)("tr",{children:[Object(M.jsx)("td",{children:e.tags.name}),Object(M.jsx)("td",{children:e.tags.place}),Object(M.jsxs)("td",{children:[Object(M.jsx)(Y,{population:+e.tags.population||0}),e.tags.population||""]}),Object(M.jsxs)("td",{children:[Object(M.jsx)("a",{href:"https://www.openstreetmap.org/#map=12/".concat(e.lat,"/").concat(e.lon),target:"_blank",rel:"noreferrer",children:"Map"})," ",Object(M.jsx)("a",{href:"https://www.openstreetmap.org/edit#map=20/".concat(e.lat,"/").concat(e.lon),target:"_blank",rel:"noreferrer",children:"Edit"})," ",Object(M.jsx)("a",{href:"https://www.openstreetmap.org/node/".concat(e.id),target:"_blank",rel:"noreferrer",children:"View"})," ",Object(M.jsx)("a",{href:"https://en.wikipedia.org/wiki/".concat(e.tags.name),target:"_blank",rel:"noreferrer",children:"Wikipedia"})," ",e.tags.wikidata&&Object(M.jsx)("a",{href:"https://www.wikidata.org/wiki/".concat(e.tags.wikidata),target:"_blank",rel:"noreferrer",children:"Wikidata"})]}),Object(M.jsx)("td",{children:!e.tags.population&&e.tags.wikidata&&Object(M.jsx)(K,{id:e.tags.wikidata,claim:Z.population})}),Object(M.jsx)("td",{children:!e.tags.population&&Object(M.jsx)(X,{name:(null===(t=e.tags.wikipedia)||void 0===t?void 0:t.replace(/[a-z]+:/,""))||e.tags.name})})]},e.id)}))})]})})]})}function B(e,t){var n=({city:{city:0,town:-1,village:-1},town:{city:1,town:0,village:-1},village:{city:1,town:1,village:0}}[e.tags.place]||{})[t.tags.place];return 0===n?String(e.tags.name).localeCompare(t.tags.name):n}function Y(e){var t,n,c=e.population;return c>1e5?(t=12,n=P[0]):c>5e4?(t=6,n=P[1]):c>1e4?(t=4,n=P[2]):c>5e3&&(t=3,n=P[3]),Object(M.jsx)("svg",{width:24,height:24,viewBox:"-12 -12 24 24",style:{verticalAlign:"text-top"},children:Object(M.jsx)("circle",{r:t,fill:n})})}function X(e){var t=e.name,n=U("https://en.wikipedia.org/api/rest_v1/page/html/".concat(t)),c=Object(s.a)(n,3),r=c[0],a=c[1],o=c[2];if(a)return Object(M.jsx)("span",{style:{color:"red"},children:a.message});if(o)return Object(M.jsx)("span",{children:"Loading\u2026"});if(r){var i=(new DOMParser).parseFromString(r,"text/html").querySelector("[data-mw*=population_ref]");if(!i)return null;try{var l,u,j=JSON.parse(i.dataset.mw).parts[0].template.params,d=function(e){var t=/\[\[([^[\]]+)\]\]/.exec(e);if(t)return t[1].split("|")[0];return e.replace(/<.*>/,"").replace(/\[\[.*\]\]/,"").replace(/^\(|\)$/g,"")}(null===(l=j.population_ref)||void 0===l?void 0:l.wt);return Object(M.jsxs)("p",{children:[j.population.wt," ",(null===(u=j.population_ref)||void 0===u?void 0:u.wt.includes("Parish"))&&Object(M.jsx)("span",{style:{color:"#FF0000",fontSize:"0.8em"},children:"Parish"})," ",Object(M.jsx)("span",{style:{color:"#666",fontSize:"0.8em"},children:d})]})}catch(h){return console.error(h),Object(M.jsx)("p",{style:{color:"red"},children:"Error parsing"})}}return Object(M.jsx)("p",{style:{color:"red"},children:"Shouldn't be here"})}var Z={pointInTime:"P585",population:"P1082"};function K(e){var t=e.id,n=e.claim,c=U("https://www.wikidata.org/wiki/Special:EntityData/".concat(t,".json")),r=Object(s.a)(c,3),a=r[0],o=r[1],i=r[2];if(o)return Object(M.jsx)("span",{style:{color:"red"},children:o.message});if(i)return Object(M.jsx)("span",{children:"Loading\u2026"});if(a)try{var l=a.entities[t].claims[n];if(l){l.sort(Q);var u=+l[0].mainsnak.datavalue.value.amount;return Object(M.jsx)("span",{children:u})}return null}catch(j){return Object(M.jsx)("span",{style:{color:"red"},children:j.message})}return Object(M.jsx)("span",{style:{color:"red"},children:"Shouldn't be here!?"})}function Q(e,t){var n,c,r=null===(n=e.qualifiers[Z.pointInTime])||void 0===n?void 0:n[0].datavalue.value.time,a=null===(c=t.qualifiers[Z.pointInTime])||void 0===c?void 0:c[0].datavalue.value.time;return-String(r).localeCompare(a)}var $=Object(l.d)({accessToken:"pk.eyJ1IjoiaWptYWNkIiwiYSI6ImNqZ2J6dnNvYjM5Y3QzMnFkYWNybzM2bnkifQ.OE6IZdjeV6XK-NGACNu60g"}),ee=function(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(n){}return}("POPMESH_CENTRE_ZOOM"),te=ee?ee.slice(0,2):[-3.667,56.66],ne=ee?ee.slice(2):[7],ce=[{id:"osm",label:"OpenStreetMap",coverage:"World"},{id:"nomis",label:"Nomis",coverage:"England and Wales"}];var re=function(){var e,t=Object(c.useState)([]),n=Object(s.a)(t,2),r=n[0],a=n[1],o=Object(c.useRef)(null),h=E("POPMESH_LOAD_ON_SCROLL",!1,!1),p=Object(s.a)(h,2),b=p[0],f=p[1],g=Object(c.useState)(!1),x=Object(s.a)(g,2),m=x[0],v=x[1],w=Object(c.useState)(null),P=Object(s.a)(w,2),_=P[0],N=P[1],T=Object(c.useState)(!1),V=Object(s.a)(T,2),H=V[0],R=V[1],D=E("POPMESH_DATA_SOURCE",ce[0].id,!1),U=Object(s.a)(D,2),J=U[0],z=U[1],q=Object(c.useState)(!1),G=Object(s.a)(q,2),B=G[0],Y=G[1],X=E("POPMESH_NODES_T1",!0,!1),Z=Object(s.a)(X,2),K=Z[0],Q=Z[1],ee=E("POPMESH_VERTICES_T1",!0,!1),re=Object(s.a)(ee,2),ae=re[0],oe=re[1],ie=E("POPMESH_VERTEX_LENGTH_T1",105e3,!1),se=Object(s.a)(ie,2),le=se[0],ue=se[1],je=E("POPMESH_NODES_T2",!0,!1),de=Object(s.a)(je,2),he=de[0],pe=de[1],be=E("POPMESH_VERTICES_T2",!0,!1),fe=Object(s.a)(be,2),Oe=fe[0],ge=fe[1],xe=E("POPMESH_VERTEX_LENGTH_T2",1e5,!1),me=Object(s.a)(xe,2),ve=me[0],ye=me[1],Se=E("POPMESH_NODES_T3",!0,!1),we=Object(s.a)(Se,2),ke=we[0],Ee=we[1],Pe=E("POPMESH_VERTICES_T3",!0,!1),_e=Object(s.a)(Pe,2),Me=_e[0],Ie=_e[1],Le=E("POPMESH_VERTEX_LENGTH_T3",95e3,!1),Ce=Object(s.a)(Le,2),Ne=Ce[0],Te=Ce[1],Ve=E("POPMESH_NODES_T4",!0,!1),Fe=Object(s.a)(Ve,2),He=Fe[0],Re=Fe[1],Ae=E("POPMESH_VERTICES_T4",!1,!1),De=Object(s.a)(Ae,2),Ue=De[0],Je=De[1],We=E("POPMESH_VERTEX_LENGTH_T4",9e4,!1),ze=Object(s.a)(We,2),qe=ze[0],Ge=ze[1],Be=E("POPMESH_NARROW_ANGLE",15,!1),Ye=Object(s.a)(Be,2),Xe=Ye[0],Ze=Ye[1],Ke=E("POPMESH_CONURBATION_COLLAPSE",!1,!1),Qe=Object(s.a)(Ke,2),$e=Qe[0],et=Qe[1],tt=Object(c.useCallback)((function(){if(o.current){var e=o.current.getBounds().toArray().flat();"osm"===J?(A(e,{population:!0,place:["city","town","village"]}).then((function(e){a(e.elements),N(null)}),N).then((function(){return v(!1)})),v(!0)):"nomis"===J&&F(e).then(a)}}),[J]);Object(c.useEffect)(tt,[H,tt]);var nt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=Object(c.useRef)(!0);return Object(c.useCallback)((function(){n.current&&(e.apply(void 0,arguments),n.current=!1,setTimeout((function(){return n.current=!0}),t))}),[e,t])}(tt,5e3);Object(c.useEffect)((function(){function e(e){"p"===e.key&&e.altKey?Y((function(e){return!e})):"Escape"===e.key&&Y(!1)}return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}));var ct=r.length>0,rt=Object(c.useMemo)((function(){return $e?function(e,t){e.sort(y);var n,c=[],r=Object(u.a)(e);try{e:for(r.s();!(n=r.n()).done;){for(var a=n.value,o=0;o<c.length;o++){var i=c[o];if(O(a,i)<t){c[o]=S(a,i);continue e}}c.push(a)}}catch(s){r.e(s)}finally{r.f()}return c}(r,3500):r}),[$e,r]);Object(c.useEffect)((function(){function e(){!b&&ct||nt();var e=o.current.getCenter().toArray(),t=o.current.getZoom();localStorage.setItem("POPMESH_CENTRE_ZOOM",JSON.stringify([].concat(Object(i.a)(e),[t])))}if(o.current)return o.current.on("moveend",e),function(){o.current.off("moveend",e)}}),[nt,b,ct,H]);var at=j(rt,1e5),ot=ae?d(at,le,Xe):[],it=j(rt,5e4,1e5),st=[].concat(Object(i.a)(at),Object(i.a)(it)),lt=Oe?d(st,ve,Xe,ot):[],ut=j(rt,1e4,5e4),jt=[].concat(Object(i.a)(at),Object(i.a)(it),Object(i.a)(ut)),dt=[].concat(Object(i.a)(ot),Object(i.a)(lt)),ht=Me?d(jt,Ne,Xe,dt):[],pt=j(rt,5e3,1e4),bt=[].concat(Object(i.a)(at),Object(i.a)(it),Object(i.a)(ut),Object(i.a)(pt)),ft=[].concat(Object(i.a)(ot),Object(i.a)(lt),Object(i.a)(ht)),Ot=Ue?d(bt,qe,Xe,ft):[],gt=null===(e=o.current)||void 0===e?void 0:e.getBounds().toArray().flat();return Object(M.jsxs)("div",{className:"App",children:[Object(M.jsxs)("div",{className:"Panel",children:[Object(M.jsxs)("label",{children:[Object(M.jsx)("span",{style:{fontWeight:"bold"},children:"Data Source"}),Object(M.jsx)("select",{value:J,onChange:function(e){return z(e.target.value)},children:ce.map((function(e){return Object(M.jsxs)("option",{value:e.id,children:[e.label," (",e.coverage,")"]},e.id)}))})]}),_?Object(M.jsx)("p",{style:{color:"red"},children:_.toString()}):m?Object(M.jsx)("p",{children:"Loading\u2026"}):Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("p",{children:Object(M.jsx)(L,{n:r.length,singular:"Total Place"})}),r.length!==rt.length&&Object(M.jsx)("p",{children:Object(M.jsx)(L,{n:rt.length,singular:"Conurbation"})})]}),Object(M.jsxs)("label",{children:[Object(M.jsx)("input",{type:"checkbox",checked:b,onChange:function(e){return f(e.target.checked)}}),"Load on pan/zoom"]}),Object(M.jsx)("button",{onClick:tt,children:"Load now"}),Object(M.jsx)(C,{label:"100k+",places:at,connectors:ot,showNodes:K,setShowNodes:Q,showVertices:ae,setShowVertices:oe,maxVertexLength:le,setMaxVertexLength:ue}),Object(M.jsx)(C,{label:"50k - 100k",places:it,connectors:lt,showNodes:he,setShowNodes:pe,showVertices:Oe,setShowVertices:ge,maxVertexLength:ve,setMaxVertexLength:ye}),Object(M.jsx)(C,{label:"10k - 50k",places:ut,connectors:ht,showNodes:ke,setShowNodes:Ee,showVertices:Me,setShowVertices:Ie,maxVertexLength:Ne,setMaxVertexLength:Te}),Object(M.jsx)(C,{label:"5k - 10k",places:pt,connectors:Ot,showNodes:He,setShowNodes:Re,showVertices:Ue,setShowVertices:Je,maxVertexLength:qe,setMaxVertexLength:Ge}),Object(M.jsx)("h2",{children:"Options"}),Object(M.jsxs)("label",{children:["Narrow Angle Limit "," ",Object(M.jsx)("input",{type:"number",min:0,max:180,value:Xe,onChange:function(e){return Ze(e.target.valueAsNumber)}})," ","(degrees)"]}),Object(M.jsxs)("label",{children:["Collapse Conurbations"," ",Object(M.jsx)("input",{type:"checkbox",checked:$e,onChange:function(e){return et(e.target.checked)}})]}),Object(M.jsx)("h2",{children:"Download"}),Object(M.jsx)("button",{onClick:function(){var e=[];K&&e.push({label:"100k+",points:at,style:"tier1_places"}),he&&e.push({label:"50k - 100k",points:it,style:"tier2_places"}),ke&&e.push({label:"10k - 50k",points:ut,style:"tier3_places"}),He&&e.push({label:"5k - 10k",points:pt,style:"tier4_places"}),ae&&e.push({label:"Connections 100k+",lines:ot,style:"tier1_connectors"}),Oe&&e.push({label:"Connections 50k - 100k",lines:lt,style:"tier2_connectors"}),Me&&e.push({label:"Connections 10k - 50k",lines:ht,style:"tier3_connectors"}),Ue&&e.push({label:"Connections 5k - 10k",lines:Ot,style:"tier4_connectors"}),function(e,t){var n=new Blob([t]),c=window.URL.createObjectURL(n),r=document.createElement("a");r.href=c,r.download=e,document.body.append(r),r.click(),setTimeout((function(){document.body.removeChild(r),window.URL.revokeObjectURL(c)}))}("places.kml",k(e))},children:"kml"})]}),Object(M.jsxs)($,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"100vh",width:"100vw"},onSourceData:function(e){o.current||R(!0),o.current=e},center:te,zoom:ne,children:[Object(M.jsx)(I,{places:K?at:[],connectors:ot,tier:1}),Object(M.jsx)(I,{places:he?it:[],connectors:lt,tier:2}),Object(M.jsx)(I,{places:ke?ut:[],connectors:ht,tier:3}),Object(M.jsx)(I,{places:He?pt:[],connectors:Ot,tier:4}),Object(M.jsx)(l.c,{}),Object(M.jsx)(l.b,{})]}),B&&Object(M.jsx)(W,{bounds:gt,sourceID:J})]})};var ae=n(8),oe=n(9),ie=n(31),se=n(30),le=function(e){Object(ie.a)(n,e);var t=Object(se.a)(n);function n(){var e;return Object(ae.a)(this,n),(e=t.call(this)).state={error:null},e}return Object(oe.a)(n,[{key:"componentDidCatch",value:function(e){this.setState({error:e})}},{key:"render",value:function(){if(this.state.error){var e=this.state.error instanceof Error?this.state.error.message:this.state.error.toString(),t=this.state.error instanceof Error?encodeURI(this.state.error.stack):"";return Object(M.jsxs)("div",{style:{margin:20},children:[Object(M.jsx)("h1",{style:{color:"#999"},children:"Sorry Population Mesh has crashed"}),Object(M.jsx)("p",{style:{color:"#666"},children:"This was slightly unexpected. Apologies for that."}),Object(M.jsx)("p",{style:{color:"#666"},children:"Population Mesh is still a work in progress so may crash occasionally."}),Object(M.jsxs)("p",{style:{color:"#666"},children:["If you feel so inclined you can report this bug at ",Object(M.jsx)("a",{href:"https://github.com/IJMacD/population-mesh/issues/new?title=".concat(e,"&body=").concat(t),children:"GitHub"}),"."]}),Object(M.jsx)("p",{style:{color:"#666"},children:Object(M.jsx)(ue,{error:this.state.error})})]})}return this.props.children}}]),n}(c.Component);function ue(e){var t=e.error;return t instanceof Error?Object(M.jsx)("code",{style:{whiteSpace:"pre"},children:t.stack||t.message}):Object(M.jsx)("code",{children:t.toString()})}o.a.render(Object(M.jsx)(r.a.StrictMode,{children:Object(M.jsx)(le,{children:Object(M.jsx)(re,{})})}),document.getElementById("root"))}},[[61,1,2]]]);
//# sourceMappingURL=main.f018121b.chunk.js.map