(this["webpackJsonppopulation-mesh"]=this["webpackJsonppopulation-mesh"]||[]).push([[0],{30:function(e,t,n){},31:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var c=n(0),o=n.n(c),r=n(11),a=n.n(r),i=(n(30),n(3)),s=n(2),l=(n(31),n(6)),u=(n(52),n(5));function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return e.filter((function(e){return t<=+e.tags.population&&+e.tags.population<n}))}function j(e,t){var n,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=[],r=Object(u.a)(e);try{for(r.s();!(n=r.n()).done;){var a,i=n.value,s=Object(u.a)(e);try{for(s.s();!(a=s.n()).done;){var l=a.value;if(i.id<l.id){var h=O(i,l);h<t&&!b(i,l,c)&&o.push([i,l])}}}catch(j){s.e(j)}finally{s.f()}}}catch(j){r.e(j)}finally{r.f()}return o}function b(e,t,n){var c,o=e.id<t.id?e:t,r=e.id<t.id?t:e,a=Object(u.a)(n);try{for(a.s();!(c=a.n()).done;){var i=Object(s.a)(c.value,2),l=i[0],h=i[1];if(o===l&&r===h)return!0}}catch(j){a.e(j)}finally{a.f()}return!1}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t<=0)return e;e.sort(d);var n,c=[],o=Object(u.a)(e);try{for(o.s();!(n=o.n()).done;){var r,a=n.value,i=!0,s=Object(u.a)(c);try{for(s.s();!(r=s.n()).done;){var l=r.value,h=m(a,l);if(h){var j=p([h[1],h[0]],[h[1],h[2]]);if(j<t){i=!1;break}}}}catch(b){s.e(b)}finally{s.f()}i&&c.push(a)}}catch(b){o.e(b)}finally{o.f()}return c}function d(e,t){return O(e[0],e[1])-O(t[0],t[1])}function O(e,t){var n=e.lat*Math.PI/180,c=t.lat*Math.PI/180,o=(t.lat-e.lat)*Math.PI/180,r=(t.lon-e.lon)*Math.PI/180,a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(c)*Math.sin(r/2)*Math.sin(r/2);return 6371e3*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}function p(e,t){var n=S(e[0],e[1]),c=S(t[0],t[1]),o=Math.abs(c-n);return o>180?180-(o-180):o}function S(e,t){var n=e.lat*Math.PI/180,c=t.lat*Math.PI/180,o=(t.lon-e.lon)*Math.PI/180,r=Math.cos(c)*Math.sin(o),a=Math.cos(n)*Math.sin(c)-Math.sin(n)*Math.cos(c)*Math.cos(o);return 180*Math.atan2(a,r)/Math.PI}function y(e,t){return e.filter((function(e){return"undefined"===typeof t.find((function(t){return e[0]===t[0]&&e[1]===t[1]}))}))}function m(e,t){return e[0]===t[0]?[e[1],e[0],t[1]]:e[0]===t[1]?[e[1],e[0],t[0]]:e[1]===t[0]?[e[0],e[1],t[1]]:e[1]===t[1]?[e[0],e[1],t[0]]:void 0}function g(e){return'<?xml version="1.0" encoding="UTF-8"?>\n<kml xmlns="http://www.opengis.net/kml/2.2">\n    <Document>\n        <Style id="tier1_places">\n            <IconStyle>\n                <color>ffffff00</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier2_places">\n            <IconStyle>\n                <color>ffcf9a02</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier3_places">\n            <IconStyle>\n                <color>ffff7f00</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier4_places">\n            <IconStyle>\n                <color>ffcc0000</color>\n            </IconStyle>\n        </Style>\n        <Style id="tier1_connectors">\n            <LineStyle>\n                <color>ffffff00</color>\n                <width>5</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier2_connectors">\n            <LineStyle>\n                <color>ffcf9a02</color>\n                <width>4</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier3_connectors">\n            <LineStyle>\n                <color>ffff7f00</color>\n                <width>3</width>\n            </LineStyle>\n        </Style>\n        <Style id="tier4_connectors">\n            <LineStyle>\n                <color>ffcc0000</color>\n                <width>2</width>\n            </LineStyle>\n        </Style>\n        '.concat(e.map((function(e){return function(e){return"\n    <Folder>\n        <name>".concat(e.label,"</name>\n        ").concat(e.points&&e.points.map((function(t){return n=t,c=e.style,"\n        <Placemark>\n            <name>".concat(n.tags.name,"</name>\n            <description>Population: ").concat(n.tags.population,"</description>\n            <styleUrl>#").concat(c,"</styleUrl>\n            <Point>\n                <coordinates>").concat(n.lon,",").concat(n.lat,",0</coordinates>\n            </Point>\n        </Placemark>");var n,c})).join(""),"\n        ").concat(e.lines&&e.lines.map((function(t){return function(e,t){var n=Object(s.a)(e,2),c=n[0],o=n[1];return"\n        <Placemark>\n            <name>From ".concat(c.tags.name," to ").concat(o.tags.name,"</name>\n            <description>Distance: ").concat(O(c,o).toFixed(0),"m</description>\n            <styleUrl>#").concat(t,"</styleUrl>\n            <Point>\n                <coordinates>\n                    ").concat(c.lon,",").concat(c.lat,",0\n                    ").concat(o.lon,",").concat(o.lat,",0\n                </coordinates>\n            </Point>\n        </Placemark>")}(t,e.style)})).join(""),"\n    </Folder>")}(e)})).join(""),"\n    </Document>\n</kml>")}function v(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=Object(c.useState)((function(){var n=localStorage.getItem(e);if(n)try{return JSON.parse(n)}catch(c){}return t instanceof Function?t():t})),r=Object(s.a)(o,2),a=r[0],i=r[1];Object(c.useEffect)((function(){if(n){var t=function(t){if(t.key===e)try{i(JSON.parse(t.newValue))}catch(t){}};return window.addEventListener("storage",t),function(){return window.removeEventListener("storage",t)}}}),[e,n]);var l=Object(c.useCallback)((function(t){i(t),localStorage.setItem(e,JSON.stringify(t))}),[i,e]);return[a,l]}var x=["#00FFFF","#029ACF","#007FFF","#0000CC"];function P(e,t){return{type:"FeatureCollection",features:[].concat(Object(i.a)(e.map((function(e){return{geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{name:e.tags.name}}}))),Object(i.a)(t.map((function(e){var t=Object(s.a)(e,2),n=t[0],c=t[1];return{geometry:{type:"LineString",coordinates:[[n.lon,n.lat],[c.lon,c.lat]]},properties:{name:"From ".concat(n.tags.name," to ").concat(c.tags.name)}}}))))}}var k=n(1);function M(e){var t=e.places,n=void 0===t?[]:t,c=e.connectors,o=void 0===c?[]:c,r=e.tier,a=P(n,[]),i=P([],o),s=function(e){return{"circle-radius":{base:5/e,stops:[[12,10/e],[22,180/e]]},"circle-color":x[e-1]}}(r),u=function(e){return{"line-width":{base:3/e,stops:[[12,5/e],[22,90/e]]},"line-color":x[e-1]}}(r);return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(l.a,{data:a,circlePaint:s}),Object(k.jsx)(l.a,{data:i,linePaint:u})]})}function E(e){var t=e.n,n=e.singular,c=e.plural,o=void 0===c?null:c;return Object(k.jsx)(k.Fragment,{children:"".concat(t," ").concat(1===t?n:o||n+"s")})}function _(e){var t=e.label,n=e.places,c=e.connectors,o=e.showNodes,r=e.setShowNodes,a=e.showVertices,i=e.setShowVertices,s=e.maxVertexLength,l=e.setMaxVertexLength;return Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)("h2",{children:t}),Object(k.jsxs)("label",{children:[Object(k.jsx)("input",{type:"checkbox",checked:o,onChange:function(e){return r(e.target.checked)}}),Object(k.jsx)(E,{n:n.length,singular:"Place"})]}),Object(k.jsxs)("label",{children:[Object(k.jsx)("input",{type:"checkbox",checked:a,onChange:function(e){return i(e.target.checked)}}),Object(k.jsx)(E,{n:c.length,singular:"Connection"})]}),Object(k.jsxs)("label",{children:["Max Connection Length (km)",Object(k.jsx)("input",{type:"number",min:0,value:s/1e3,onChange:function(e){return l(1e3*e.target.valueAsNumber)}})]})]})}var w=Object(l.d)({accessToken:"pk.eyJ1IjoiaWptYWNkIiwiYSI6ImNqZ2J6dnNvYjM5Y3QzMnFkYWNybzM2bnkifQ.OE6IZdjeV6XK-NGACNu60g"}),N=function(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(n){}return}("POPMESH_CENTRE_ZOOM"),L=N?N.slice(0,2):[-3.667,56.66],T=N?N.slice(2):[7];var I=function(){var e=Object(c.useState)([]),t=Object(s.a)(e,2),n=t[0],o=t[1],r=Object(c.useRef)(null),a=v("POPMESH_LOAD_ON_SCROLL",!1),u=Object(s.a)(a,2),j=u[0],b=u[1],f=Object(c.useState)(!1),d=Object(s.a)(f,2),O=d[0],p=d[1],S=Object(c.useState)(null),y=Object(s.a)(S,2),m=y[0],x=y[1],P=Object(c.useState)(!1),N=Object(s.a)(P,2),I=N[0],F=N[1],H=v("POPMESH_NODES_T1",!0,!1),R=Object(s.a)(H,2),A=R[0],D=R[1],J=v("POPMESH_VERTICES_T1",!0,!1),U=Object(s.a)(J,2),G=U[0],X=U[1],Y=v("POPMESH_VERTEX_LENGTH_T1",105e3,!1),Z=Object(s.a)(Y,2),q=Z[0],z=Z[1],W=v("POPMESH_NODES_T2",!0,!1),B=Object(s.a)(W,2),Q=B[0],K=B[1],$=v("POPMESH_VERTICES_T2",!0,!1),ee=Object(s.a)($,2),te=ee[0],ne=ee[1],ce=v("POPMESH_VERTEX_LENGTH_T2",1e5,!1),oe=Object(s.a)(ce,2),re=oe[0],ae=oe[1],ie=v("POPMESH_NODES_T3",!0,!1),se=Object(s.a)(ie,2),le=se[0],ue=se[1],he=v("POPMESH_VERTICES_T3",!0,!1),je=Object(s.a)(he,2),be=je[0],fe=je[1],de=v("POPMESH_VERTEX_LENGTH_T3",95e3,!1),Oe=Object(s.a)(de,2),pe=Oe[0],Se=Oe[1],ye=v("POPMESH_NODES_T4",!0,!1),me=Object(s.a)(ye,2),ge=me[0],ve=me[1],xe=v("POPMESH_VERTICES_T4",!1,!1),Pe=Object(s.a)(xe,2),ke=Pe[0],Me=Pe[1],Ee=v("POPMESH_VERTEX_LENGTH_T4",9e4,!1),_e=Object(s.a)(Ee,2),we=_e[0],Ne=_e[1],Le=v("POPMESH_NARROW_ANGLE",20,!1),Te=Object(s.a)(Le,2),Ie=Te[0],Ve=Te[1],Ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=Object(c.useRef)(!0);return Object(c.useCallback)((function(){n.current&&(e.apply(void 0,arguments),n.current=!1,setTimeout((function(){return n.current=!0}),t))}),[e,t])}(Fe,5e3);function Fe(){r.current&&(function(e){var t=e.map((function(e){return e.toFixed(3)})).join(",");return function(e){var t=C.find((function(t){return t.url===e}));t||(t={url:e,result:fetch(e).then((function(e){return e.ok?e.json():429===e.status?Promise.reject("Too many requests. Please wait a minute."):Promise.reject("Error fetching data")}))},C.unshift(t),C.length=Math.min(10,C.length));return t.result}("https://overpass-api.de/api/interpreter?data=[out:json][bbox];(node[population];);out;&bbox=".concat(t))}(r.current.getBounds().toArray().flat()).then((function(e){o(e.elements),x(null)}),x).then((function(){return p(!1)})),p(!0))}var He=n.length>0;Object(c.useEffect)((function(){function e(){!j&&He||Ce();var e=r.current.getCenter().toArray(),t=r.current.getZoom();localStorage.setItem("POPMESH_CENTRE_ZOOM",JSON.stringify([].concat(Object(i.a)(e),[t])))}if(r.current)return r.current.on("sourcedata",e),function(){r.current.off("sourcedata",e)}}),[Ce,j,He,I]);var Re=h(n,1e5),Ae=G?V(Re,q,Ie):[],De=h(n,5e4,1e5),Je=te?V([].concat(Object(i.a)(Re),Object(i.a)(De)),re,Ie,Ae):[],Ue=h(n,1e4,5e4),Ge=be?V([].concat(Object(i.a)(Re),Object(i.a)(De),Object(i.a)(Ue)),pe,Ie,Object(i.a)(Ae)):[],Xe=h(n,5e3,1e4),Ye=ke?V([].concat(Object(i.a)(Re),Object(i.a)(De),Object(i.a)(Ue),Object(i.a)(Xe)),we,Ie,[].concat(Object(i.a)(Ae),Object(i.a)(Je),Object(i.a)(Ge))):[];return Object(k.jsxs)("div",{className:"App",children:[Object(k.jsxs)("div",{className:"Panel",children:[m?Object(k.jsx)("p",{style:{color:"red"},children:m.toString()}):Object(k.jsx)("p",{children:O?"Loading\u2026":Object(k.jsx)(E,{n:n.length,singular:"Total Place"})}),Object(k.jsxs)("label",{children:[Object(k.jsx)("input",{type:"checkbox",checked:j,onChange:function(e){return b(e.target.checked)}}),"Load on pan/zoom"]}),Object(k.jsx)("button",{onClick:Fe,children:"Load now"}),Object(k.jsx)(_,{label:"100k+",places:Re,connectors:Ae,showNodes:A,setShowNodes:D,showVertices:G,setShowVertices:X,maxVertexLength:q,setMaxVertexLength:z}),Object(k.jsx)(_,{label:"50k - 100k",places:De,connectors:Je,showNodes:Q,setShowNodes:K,showVertices:te,setShowVertices:ne,maxVertexLength:re,setMaxVertexLength:ae}),Object(k.jsx)(_,{label:"10k - 50k",places:Ue,connectors:Ge,showNodes:le,setShowNodes:ue,showVertices:be,setShowVertices:fe,maxVertexLength:pe,setMaxVertexLength:Se}),Object(k.jsx)(_,{label:"5k - 10k",places:Xe,connectors:Ye,showNodes:ge,setShowNodes:ve,showVertices:ke,setShowVertices:Me,maxVertexLength:we,setMaxVertexLength:Ne}),Object(k.jsx)("h2",{children:"Options"}),Object(k.jsxs)("label",{children:["Narrow Angle Limit (degrees)",Object(k.jsx)("input",{type:"number",min:0,max:180,value:Ie,onChange:function(e){return Ve(e.target.valueAsNumber)}})]}),Object(k.jsx)("h2",{children:"Download"}),Object(k.jsx)("button",{onClick:function(){var e=[];A&&e.push({label:"100k+",points:Re,style:"tier1_places"}),Q&&e.push({label:"50k - 100k",points:De,style:"tier2_places"}),le&&e.push({label:"10k - 50k",points:Ue,style:"tier3_places"}),ge&&e.push({label:"5k - 10k",points:Xe,style:"tier4_places"}),G&&e.push({label:"Connections 100k+",lines:Ae,style:"tier1_connectors"}),te&&e.push({label:"Connections 50k - 100k",lines:Je,style:"tier2_connectors"}),be&&e.push({label:"Connections 10k - 50k",lines:Ge,style:"tier3_connectors"}),ke&&e.push({label:"Connections 5k - 10k",lines:Ye,style:"tier4_connectors"}),function(e,t){var n=new Blob([t]),c=window.URL.createObjectURL(n),o=document.createElement("a");o.href=c,o.download=e,document.body.append(o),o.click(),setTimeout((function(){document.body.removeChild(o),window.URL.revokeObjectURL(c)}))}("places.kml",g(e))},children:"kml"})]}),Object(k.jsxs)(w,{style:"mapbox://styles/mapbox/streets-v9",containerStyle:{height:"100vh",width:"100vw"},onSourceData:function(e){r.current||F(!0),r.current=e},center:L,zoom:T,children:[Object(k.jsx)(M,{places:A?Re:[],connectors:Ae,tier:1}),Object(k.jsx)(M,{places:Q?De:[],connectors:Je,tier:2}),Object(k.jsx)(M,{places:le?Ue:[],connectors:Ge,tier:3}),Object(k.jsx)(M,{places:ge?Xe:[],connectors:Ye,tier:4}),Object(k.jsx)(l.c,{}),Object(k.jsx)(l.b,{})]})]})};function V(e,t,n){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=j(e,t);return n>0&&(o=f(o,n)),o=y(o,c)}var C=[];a.a.render(Object(k.jsx)(o.a.StrictMode,{children:Object(k.jsx)(I,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.fc9a4ae7.chunk.js.map